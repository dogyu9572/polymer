<?session_start();include $_SERVER['DOCUMENT_ROOT'] . "/common/conf/config.inc.php";include_once $_SERVER['DOCUMENT_ROOT'] . "/common/conf/dbconfig.inc.php";include_once $_SERVER['DOCUMENT_ROOT'] . "/module/member/member.lib.php";include_once $_SERVER['DOCUMENT_ROOT'] . "/module/shop/shop.lib.php";include_once $_SERVER['DOCUMENT_ROOT'] . "/module/coupon/coupon.lib.php";include_once $_SERVER['DOCUMENT_ROOT'] . "/module/point/point.lib.php";include_once $_SERVER['DOCUMENT_ROOT'] . "/module/board/board.lib.php";include_once $_SERVER['DOCUMENT_ROOT'] . "/module/mail/mail.lib.php";//echo password_hash("test1234", PASSWORD_DEFAULT);//exit;//DB연결$dblink = SetConn($_conf_db["main_db"]);if($_POST['evnMode']=="join"){	###############################################자동등록방지############################################ //ST	/************	include_once $_SERVER['DOCUMENT_ROOT'] . "/_securimage/securimage.php";	$img = new Securimage();	$valid = $img->check($_POST['code']);	if($valid == true) {	} else {		jsMsg("자동등록방지 입력 오류");		jsHistory("-1") ;		exit;	}	**********/	###############################################자동등록방지############################################ //ED	$RS = joinMember();	//로그인용	$arrInfo = getUserInfo(mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user_id']));	if($RS==true){		######################################## 전문가회원 문자발송 ###################################				if($_SITE["SHOP_JOIN_YN"]=="Y"){		//	setPlusPoint($_POST['user_id'], $_SITE["SHOP_JOIN_POINT"], "회원가입 적립금");		}		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["ID"]		= $arrInfo["list"][0]["user_id"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["NAME"]		= $arrInfo["list"][0]["user_name"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["EMAIL"]	= $arrInfo["list"][0]["email"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["TYPE"]		= $arrInfo["list"][0]["join_type"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["GUBUN"]	= $arrInfo["list"][0]["etc_1"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["GENDER"]	= $arrInfo["list"][0]["gender"];		//회원에게 메일발송		//$arrMailInfo = getMailConfig("join");		//sendMailMemberInfo($arrInfo, $arrMailInfo);		if($arrInfo["list"][0]["email_accept"] == "Y"){			//sendMailJoin($arrInfo);		}		//kakaoAllim($kakao_tpl_no="001", $arrInfo["list"][0]["user_name"], $arrInfo["list"][0]["mobile"], $arrInfo["list"][0]["user_id"], $note1="", $note2="", $note3="", $note4="", $note5="");		jsGo($_POST['returnUrl'],"","회원가입이 완료되었습니다.");	}else{		jsMsg("회원가입에 실패 하였습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="social_join"){	$RS = joinSocialMember();	//로그인용	$arrInfo = getUserInfo(mysqli_real_escape_string($GLOBALS['dblink'], $_SESSION['social']['id']));	if($RS==true){		######################################## 전문가회원 문자발송 ###################################				if($_SITE["SHOP_JOIN_YN"]=="Y"){		//	setPlusPoint($_POST['user_id'], $_SITE["SHOP_JOIN_POINT"], "회원가입 적립금");		}		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["ID"]		= $arrInfo["list"][0]["user_id"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["NAME"]		= $arrInfo["list"][0]["user_name"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["EMAIL"]	= $arrInfo["list"][0]["email"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["TYPE"]		= $arrInfo["list"][0]["join_type"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["GUBUN"]	= $arrInfo["list"][0]["etc_1"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["GENDER"]	= $arrInfo["list"][0]["gender"];		//회원에게 메일발송		//$arrMailInfo = getMailConfig("join");		//sendMailMemberInfo($arrInfo, $arrMailInfo);		if($arrInfo["list"][0]["email_accept"] == "Y"){			//sendMailJoin($arrInfo);		}		//kakaoAllim($kakao_tpl_no="001", $arrInfo["list"][0]["user_name"], $arrInfo["list"][0]["mobile"], $arrInfo["list"][0]["user_id"], $note1="", $note2="", $note3="", $note4="", $note5="");		jsGo($_POST['returnUrl'],"","회원가입이 완료되었습니다.");	}else{		jsMsg("회원가입에 실패 하였습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="join_vip"){	$RS = joinMemberVIP();	//로그인용	$arrInfo = getUserInfo(mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user_id']));	if($RS==true){		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["ID"]		= $arrInfo["list"][0]["user_id"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["NAME"]		= $arrInfo["list"][0]["user_name"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["EMAIL"]	= $arrInfo["list"][0]["email"];		$_SESSION[$_SITE["DOMAIN"]]["JOIN"]["TYPE"]		= $arrInfo["list"][0]["join_type"];					jsGo($_POST['returnUrl'],"","");	}else{		jsMsg("회원가입에 실패 하였습니다.");	}}else if($_POST['evnMode']=="edit_golden"){	$RS = editMember_golden($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);	if($RS==true){		jsGo("/member/modify.php","","회원정보가 수정되었습니다.");	}else{		jsMsg("정보 수정에 실패 하였습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="edit"){	$RS = editMember($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);	if($RS==true){        if($_REQUEST["rt_url"]){            jsGo($_REQUEST["rt_url"],"","회원정보가 수정되었습니다.");        }else{            jsGo("/mypage/editForm.php","","회원정보가 수정되었습니다.");        }	}else{		jsMsg("정보 수정에 실패 하였습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="engname"){	$RS = editMemberEngName($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);	if($RS==true){		jsGo("/include/seminar.php","","영문 이름이 등록되었습니다.");	}else{		jsMsg("정보 수정에 실패 하였습니다.");	//		jsHistory("-1") ;	}}else if($_POST['evnMode']=="editPw"){	$RS = editPasswd($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);	if($RS==true){		jsGo("/member.php?goPage=Pass","","고객님의 비밀번호가 수정되었습니다.");	}else{		jsMsg("기존 비밀번호가 일치하지 않습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="FindPWedit"){ // 비밀번호 찾기 변경 추가	$RS = getUserFindPWedit(mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user_id']),"",mysqli_real_escape_string($GLOBALS['dblink'], $_POST['mobile']));	if($RS==true){		jsGo("/me/result_pwd.php","","");	}else{		jsMsg("정보 수정에 실패 하였습니다.");	//	jsHistory("-1") ;	}}else if($_POST['evnMode']=="emailAccept"){	if(!$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]){		jsMsg("로그인이 필요한 서비스 입니다.");		jsHistory("-1") ;		exit;	}	$RS = editMemberEmailAccept($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);	if($RS==true){		jsGo("index.php","","메일 서비스를 신청 하였습니다.");	}else{		jsMsg("메일 서비스 신청에 실패 하였습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="withdrawal"){	$user_id = $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"];	$user_pw = $_POST['user_pw'];	$arrInfo = getUserInfo($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);	if($arrInfo["total"] > 0){		if($arrInfo["list"][0]["user_type"] == "homepage"){			$arrPwInfo = getDecryptPw($user_pw);			if($arrInfo["list"][0]["user_pw"] != $arrPwInfo["list"][0]["pw"]){				jsMsg("입력하신 정보가 올바르지 않습니다.");				jsHistory("-1") ;			}		}		$RS2 = deleteMember($user_id);	// 탈퇴회원으로 전환		//$RS2 = outMember($RS["list"][0]["user_id"]);	// 바로 탈퇴		if($RS2 == true){			session_destroy();			//탈퇴자에게 메일발송			//	$arrMailInfo = getMailConfig("withdrawal");			//sendMailMemberInfo($arrInfo, $arrMailInfo);			if($_REQUEST["rt_url"]){				jsGo($_REQUEST["rt_url"],"",$arrInfo["list"][0]["user_name"] . "님 정상적으로 탈퇴 되었습니다.");			}else{				jsGo("/","",$arrInfo["list"][0]["user_name"] . "님 정상적으로 탈퇴 되었습니다.");				//jsGo("/","","Membership has been successfully terminated.");			}		}else{			if($_REQUEST["rt_url"]){				jsGo($_REQUEST["rt_url"],"","탈퇴처리중 오류가 발생하였습니다.");			}else{				jsGo("/","","탈퇴처리중 오류가 발생하였습니다.");			}		}	}else{		//jsMsg("Passwords do not match.");		jsMsg("입력하신 정보가 올바르지 않습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="login"){    updateMemberLevelByViolation(); // 정지 회원 자동 해제	$user_id = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['id']));	$user_pw = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['pw']));	if($_POST['uniteUser']=="naver" || $_POST['uniteUser']=="kakao"){		$arrInfo = getUserInfoUnite($user_id, "Y", $_POST['uniteUser']);	}else{		$arrInfo = getUserInfo($user_id, "Y");	}	if($arrInfo["total"] < 1){		jsMsg("해당하는 회원 정보가 없습니다.");		jsHistory("-1");		exit();	}	if($_POST['uniteUser']=="naver" || $_POST['uniteUser']=="kakao"){		$RS = loginMemberUnite($user_id, $user_pw, $_POST['uniteUser']);	}else{		if ($arrInfo["list"][0]["before"] == "Y") {			$RS = loginMemberBefore($user_id, $user_pw);		} else {			$RS = loginMember($user_id, $user_pw);		}	}    if($RS["list"][0]["before"] == "Y") {       $user_name = base64_decode($RS["list"][0]["user_name"]);       $email = base64_decode($RS["list"][0]["email"]);       $mobile = base64_decode($RS["list"][0]["mobile"]);    }    else {       $user_name = $RS["list"][0]["user_name"];       $email = $RS["list"][0]["email"];       $mobile = $RS["list"][0]["mobile"];    }	if($RS["total"] > 0){		if($RS["list"][0]["user_level"]=="0"){	// 기본값 변경 1			jsMsg("관리자 인증후 로그인이 가능합니다.");			jsHistory("-1") ;		}else{			$arrLevelInfo  = getMemberLevelInfo($RS["list"][0]["user_level"]); //등급정보			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"] = $RS["list"][0]["user_id"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["NAME"] = $user_name;			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["EMAIL"] = $email;			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["TEL"] = $mobile;			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["LEVEL"] = $RS["list"][0]["user_level"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["BIRTH"] = $RS["list"][0]["birth"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["LEVELPOINT"] = $arrLevelInfo["list"][0]["level_point"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["USERCODE"] = $RS["list"][0]["nick_name"];            $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["GENDER"] = $RS["list"][0]["gender"];			if($_REQUEST[save_id]=="1"){				setcookie("login_id", $RS["list"][0]["user_id"], time()+(3600*24*30), "/", $_SERVER['SERVER_NAME']);			}else{				setcookie("login_id", "", time()+(3600*24*30), "/", $_SERVER['SERVER_NAME']);			}			if($_REQUEST['rt_url']){				jsGo($_REQUEST['rt_url'],"","");			}else{				jsGo("/","","");			}		}	}else{		jsMsg("비밀번호가 일치하지 않습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="regLogin"){################################################### 로보월드 ##################################################	$user_id = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['reg01']."-".$_POST['reg02']."-".$_POST['reg03']));	$user_pw = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['pw']));	$arrInfo = getUserInfoBoard($user_id);	if($arrInfo["total"] < 1){		jsMsg("해당하는 로그인 정보가 없습니다.");		jsHistory("-1");	}	$RS = loginMemberBoard($user_id, $user_pw);	if($RS["total"] > 0){		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]		= $RS["list"][0]["registration"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["LEVEL"]	= "BIZ";	// 참가업체:BIZ / 참관객:USER		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["CLASS"]	= $RS["list"][0]["category"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["NAME"]	= $RS["list"][0]["user1_name"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["EMAIL"]	= $RS["list"][0]["user1_email"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["TEL"]	= $RS["list"][0]["user1_mobile"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["COMPANY"]	= $RS["list"][0]["ko_company"];		if($_REQUEST['rt_url']){			jsGo($_REQUEST['rt_url'],"","");		}else{			jsGo("/","","");		}	}else{		jsMsg("비밀번호가 일치하지 않습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="regUserLogin"){################################################### 로보월드 ##################################################	$user_id = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['email']));	$user_pw = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['pw']));	$arrInfo = getUserInfoBoard2($user_id);	if($arrInfo["total"] < 1){		jsMsg("해당하는 로그인 정보가 없습니다.");		jsHistory("-1");	}	$RS = loginMemberBoard2($user_id, $user_pw);	if($RS["total"] > 0){		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]		= $RS["list"][0]["email"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["LEVEL"]	= "USER";	// 참가업체:BIZ / 참관객:USER		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["CLASS"]	= $RS["list"][0]["category"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["UTYPE"]	= $RS["list"][0]["join_type"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["NAME"]	= $RS["list"][0]["user_name"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["EMAIL"]	= $RS["list"][0]["email"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["TEL"]	= $RS["list"][0]["user_mobile"];		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["COMPANY"]	= $RS["list"][0]["ko_company"];		if($_REQUEST['rt_url']){			jsGo($_REQUEST['rt_url'],"","");		}else{			jsGo("/","","");		}	}else{		jsMsg("비밀번호가 일치하지 않습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="passwordCheck"){	$user_id = $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"];	$user_pw = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['pw']));	$RS = loginMemberPassword($user_id, $user_pw);	if($RS["total"] > 0){		jsGo("/include/edit_member_information3.php","","");	}else{		jsMsg("비밀번호가 일치하지 않습니다.");		jsHistory("-1");	}}else if($_POST['evnMode']=="userLogin"){	$user_id = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['id']));	$user_pw = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['pw']));	$arrInfo = getUserInfo($user_id, "Y");	if($arrInfo["total"] < 1){		jsMsg("아이디를 확인하세요.");		jsHistory("-1");	}	if($_POST['admflag']=="userLoginAdm" && $_POST['pw']=="homepagekorea"){	################# 관리자용 로그인 추가 jeejin 0809 / login_adm.php		$RS = loginMemberPasswordAdmin($user_id, $user_pw);	}else{		$RS = loginMemberPassword($user_id, $user_pw);	}	if($RS["total"] > 0){		if($RS["list"][0]["user_level"]<1){	// 기본값 변경 1			jsMsg("관리자 인증후 로그인이 가능합니다.");			jsHistory("-1") ;		}else{			$arrLevelInfo  = getMemberLevelInfo($RS["list"][0]["user_level"]); //등급정보			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]		= $RS["list"][0]["user_id"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["NAME"]	= $RS["list"][0]["user_name"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["EMAIL"]	= $RS["list"][0]["email"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["TEL"]	= $RS["list"][0]["mobile"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["LEVEL"]	= $RS["list"][0]["user_level"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["JTYPE"]	= $RS["list"][0]["join_type"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ACLASS"]	= $RS["list"][0]["a_class"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["COMPANY"]= $RS["list"][0]["etc_1"];			$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["CEO"]	= $RS["list"][0]["etc_3"];			if($_REQUEST['save_id']=="1"){				setcookie("login_id", $RS["list"][0]["user_id"], time()+(3600*24*30), "/", $_SERVER['SERVER_NAME']);			}else{				setcookie("login_id", "", time()+(3600*24*30), "/", $_SERVER['SERVER_NAME']);			}			//휴면전환메일발송여부 체크			//$sql = "update tbl_member set etc_2='N' where user_id='".$arrList['list'][$i]['user_id']."'";			//$rs = mysql_query($sql, $GLOBALS['dblink']);			//장바구니의 해당 세션을 로그인한 회원의 장바구니로 옮김			@updateCartSession($_SESSION[$_SITE["DOMAIN"]]["SESSIONID"], $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);			########################################################### 쿠폰등록 ########################################################### ST			// 전체쿠폰리스트			$arrCouponList = getCouponListOrder(0, 0, "Y", date("Y-m-d"), "");			// 내쿠폰정보			$arrMyCouponList =getMypageCouponList($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"], "", 0, 0, "", "");			if($arrCouponList["total"]>0){				for($j=0;$j<$arrCouponList["total"];$j++){					$goodFlag = true;					for($m=0;$m<$arrMyCouponList['total'];$m++){						if($arrMyCouponList['list'][$m]['e_idx']==$arrCouponList["list"][$j]['idx']){							$goodFlag = false;						}					}					if($goodFlag){						if($arrCouponList["list"][$j]['coupon_type']=="auto"){		## 자동등록 : 전체 회원							$coupon_idx = getUserCouponReturn($arrCouponList["list"][$j]['idx'], $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);						}else{							########################################################## 수동등록 : 주소록 ST							$couponOk = false;							$subQuery = " AND idx in (".$arrCouponList["list"][$j]['addidxs'].") ";							$arrBoardList = getBoardListBase("contact", "", "", "", 0, 0, $subQuery);							for($i=0; $i < $arrBoardList["list"]["total"]; $i++){								$subQuery2 = " AND idx in (".$arrBoardList["list"][$i]['joinidxs'].") ";								$arrMemberList = getMemberList ("", "", "", 0, 0, $subQuery2);								for($m=0; $m < $arrMemberList["list"]["total"]; $m++){									if($arrMemberList["list"][$m]['user_id']==$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]){										$couponOk = true;									}								}							}							if($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["LEVEL"]==$arrCouponList["list"][$j]['member_level']){	## 회원등급이 같으면 자동 발급								$couponOk = true;							}							if($couponOk){		## 쿠폰 발급								$coupon_idx = getUserCouponReturn($arrCouponList["list"][$j]['idx'], $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);							}							########################################################## 수동등록 : 주소록 ED						}					}				}			}			########################################################### 쿠폰등록 ########################################################### ED			/******************************			//회원가입 쿠폰이 없을때			$arrCoupon = getMypageCouponList($RS["list"][0]["user_id"], "", 0, 0, "", "");			if($RS["list"][0]["idx"] < 11075){	## 기존회원은 쿠폰 발행 안함 20210806				$arrCoupon["total"]=1;			}else{				$joinCouponCnt = getMyCouponCount("46");				if($joinCouponCnt["total"] > 6000){		## 발급된 쿠폰수 6천개 이상이면 발급 중단					$arrCoupon["total"]=1;				}			}			if($arrCoupon["total"]==0) {				$arrCouponInfo = getCouponInfo("46");				$coupon_name="회원가입쿠폰";				$serial = substr(strtoupper(md5($coupon_name.$RS["list"][0]["user_id"].microtime(true))),0,16);				$edate =  date("Y-m-d", mktime(0,0,0,date("m")+$arrCouponInfo["list"][0]['coupon_content'],date("d"),date("Y")));				//쿠폰발행				$sql = "INSERT INTO tbl_mycoupon SET					user_id='".$RS["list"][0]["user_id"]."',					e_idx='46',					coupon_no='".$serial."',					coupon_name='".$coupon_name."',					coupon_dis='".$arrCouponInfo["list"][0][coupon_dis]."',					coupon_unit='".$arrCouponInfo["list"][0][coupon_unit]."',					coupon_sdate=now(),					coupon_edate='".$edate."',					coupon_use='N',					over_price='".$arrCouponInfo["list"][0][over_price]."',					under_price='".$arrCouponInfo["list"][0][under_price]."',					wdate=now()				";				$rs =  mysqli_query($GLOBALS['dblink'], $sql);			}			***************************************/			if($_REQUEST['rt_url']){				jsGo($_REQUEST['rt_url'],"","");			}else{				jsGo("/","","");			}		}	}else{		jsMsg("비밀번호가 일치하지 않습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="oldUserLogin"){	$user_id = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['id']));	$user_pw = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['pw']));	if($_POST['pw']!="abcd123456"){	## 무조건 해당 비밀번호아니면 리턴;		jsMsg("비밀번호를 확인하세요.");		jsHistory("-1");		exit();	}	$query = "select * from tbl_member_old where etc_10='".$user_id."' ";	$arrInfo = getFreeQueryR($query);	if($arrInfo["total"] < 1){		jsMsg("거래처 등록 코드를 확인하세요.");		jsHistory("-1");		exit();	}else{		if($arrInfo["total"] == 1){			$query = "select job from tbl_member where job='".$arrInfo["list"][0]["idx"]."' ";			$arrMemberInfo = getFreeQueryR($query);			if($arrMemberInfo["total"]>0){				jsGo("/member/login.php","top","이미 가입된 회원정보가 있습니다.");			}else{				$_SESSION[$_SITE["DOMAIN"]]["OLDMEMBER"]["KEYIDX"]	= $arrInfo["list"][0]["idx"];				jsGo("/member/join_vip.php","top","");			}		}else{			$_SESSION[$_SITE["DOMAIN"]]["OLDMEMBER"]["UID"]	= $arrInfo["list"][0]["user_id"];			jsGo("/member/pop_select_branch.php","","");		}	}}else if($_POST['evnMode']=="memberCheck"){	// 회원정보 수정 > 비밀번호 확인	$user_id = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['id']));	$user_pw = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['pw']));	$arrInfo = getUserInfo($user_id, "Y");	if($arrInfo["total"] < 1){		jsMsg("아이디를 확인하세요.");		jsHistory("-1");	}	$RS = loginMemberPassword($user_id, $user_pw);	if($RS["total"] > 0){		$arrLevelInfo  = getMemberLevelInfo($RS["list"][0]["user_level"]); //등급정보		$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["PWCHECK"] = true;		jsGo("/member/editForm.php","","");	}else{		jsMsg("비밀번호가 일치하지 않습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="login_guest"){	$_SESSION[$_SITE["DOMAIN"]]["GUEST"]["NAME"] = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['name']));	if($_REQUEST['rt_url']){		jsGo($_REQUEST['rt_url'],"","");	}else{		jsGo("/","","");	}}else if($_POST['evnMode']=="login_guest2"){	$arrList = getOrderListGuest(mysqli_real_escape_string($GLOBALS['dblink'], $_POST['order_name']), mysqli_real_escape_string($GLOBALS['dblink'], $_POST['order_pw']), 0, 0);		if($arrList["total"]>0){			$_SESSION[$_SITE["DOMAIN"]]["GUEST"]["NAME"] = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['order_name']));		$_SESSION[$_SITE["DOMAIN"]]["GUEST"]["PW"] = mysqli_real_escape_string($GLOBALS['dblink'], trim($_POST['order_pw']));		jsGo("/shop.php?goPage=OrderList","","");	} else {		jsMsg("입력하신 주문자명 혹은 주문비밀번호가 맞지 않습니다.");		jsHistory("-1") ;	}}else if($_REQUEST['evnMode']=="logout"){	session_destroy();	if($_REQUEST['rt_url']){		jsGo($_REQUEST['rt_url'],"","로그아웃 되었습니다.");	}else{		jsGo("/","","로그아웃 되었습니다.");	}}else if($_POST['evnMode']=="address_insert"){	$RS = insertAddress($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);	if($RS==true){		jsGo($_POST['retUrl'],"","배송지 정보를 입력 하였습니다.");		//	return "ok";	}else{		jsMsg("정보 입력에 실패 하였습니다.");		//jsHistory("-1") ;		//return "fail";	}}else if($_POST['evnMode']=="address_insert2"){	$RS = insertAddress($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]);	if($RS==true){		jsGo("/sub/myaddress_popup.php","","배송지 정보를 입력 하였습니다.");	}else{		jsMsg("정보 입력에 실패 하였습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="address_edit"){	$RS = editAddress(mysqli_real_escape_string($GLOBALS['dblink'], $_POST['idx']));	if($RS==true){		jsGo("/member/delivery.php","","배송지 정보를 수정 하였습니다.");			}else{		//jsMsg("정보 수정에 실패 하였습니다.");		//jsHistory("-1") ;		return "fail";	}}else if($_POST['evnMode']=="address_edit2"){	$RS = editAddress(mysqli_real_escape_string($GLOBALS['dblink'], $_POST['idx']));	if($RS==true){		jsGo("/sub/myaddress_popup.php","","배송지 정보를 수정 하였습니다.");	}else{		jsMsg("정보 수정에 실패 하였습니다.");		jsHistory("-1") ;	}}else if($_POST['evnMode']=="address_delete"){	$RS = deleteAddress(mysqli_real_escape_string($GLOBALS['dblink'], $_POST['idx']));	if($RS==true){		//jsGo($_REQUEST['returnURL'],"","배송지 정보를 삭제 하였습니다.");		return "ok";	}else{		//jsMsg("정보 삭제에 실패 하였습니다.");		//jsHistory("-1") ;		return "fail";	}}else if($_POST['evnMode']=="coupon2022event"){	$couponIDX = "57";	//쿠폰이 없을때	$arrCoupon = getMyCouponCheckInfo($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"], $couponIDX);	if($_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["LEVEL"]=="3"){	## 임직원		jsGo($_REQUEST['rt_url'],"","해당 이벤트에 임직원분들은 참여하실 수 없습니다. 죄송합니다.");				exit();	}		if($arrCoupon["total"]==0) {		$couponCount = getMyCouponCountDay($couponIDX, date("Y-m-d"));		if($couponCount["total"]>200) {			jsGo($_REQUEST['rt_url'],"","선착순 200명이 초과 되었습니다.");		}				$arrCouponInfo = getCouponInfo($couponIDX);		$coupon_name="리뉴얼기념쿠폰5000";		$serial = substr(strtoupper(md5($coupon_name.$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"].microtime(true))),0,16);		$edate =  date("Y-m-d", mktime(0,0,0,date("m")+$arrCouponInfo["list"][0][coupon_content],date("d"),date("Y")));		//쿠폰발행		$sql = "INSERT INTO tbl_mycoupon SET			user_id='".$_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["ID"]."',			e_idx='".$couponIDX."',			coupon_no='".$serial."',			coupon_name='".$arrCouponInfo["list"][0][coupon_name]."',			coupon_dis='".$arrCouponInfo["list"][0][coupon_dis]."',			coupon_unit='".$arrCouponInfo["list"][0][coupon_unit]."',			coupon_sdate=now(),			coupon_edate='".$edate."',			coupon_use='N',			over_price='".$arrCouponInfo["list"][0][over_price]."',			under_price='".$arrCouponInfo["list"][0][under_price]."',			wdate=now()		";		//echo $sql;		$rs = mysqli_query($GLOBALS['dblink'], $sql);		if($_REQUEST['rt_url']){			jsGo($_REQUEST['rt_url'],"","쿠폰이 발행되었습니다.");		}else{			jsGo("/","","쿠폰이 발행되었습니다.");		}	}else{		if($_REQUEST['rt_url']){			jsGo($_REQUEST['rt_url'],"","이미 쿠폰다운이 되었습니다.");		}else{			jsGo("/","","이미 쿠폰다운이 되었습니다.");		}	}	}else if($_POST["evnMode"] == "pw_change"){	$nick_name = $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["USERCODE"];	$arrList = getUserInfoNnickname($nick_name);	//기존회원 아이디 찾기	if ($arrList["total"] == 0) {		$name = $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["NAME"];		$mobile = $_SESSION[$_SITE["DOMAIN"]]["MEMBER"]["TEL"];		$arrList = getMemberInfoByNameAndMobile($name, $mobile);	}	if($arrList["total"] > 0){		if($arrList["list"][0]["join_type"] == "homepage"){			$rs = editPasswd($arrList["list"][0]["user_id"]);			if($rs){				jsGo($_POST["returnURL"] . "?status=success", "", "");			}else{				jsMsg("비밀번호 변경에 실패했습니다.");				jsHistory("-1");			}		}else{			jsGo("/member/login.php","","소셜회원은 비밀번호를 변경하실수 없습니다.");		}	}else{		jsGo("/member/login.php","","해당하는 아이디가 없습니다.");	}}	//DB해제SetDisConn($dblink);?>