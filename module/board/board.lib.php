<?/*********************************** 게시판 관리 *************************************///게시판 디비 만들기function makeBoard($boardid){    // 테이블 중복검사(게시판용 테이블이 아닌 일반용에서)    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    ## $Table_exist = mysql_list_tables($GLOBALS["_conf_db"]["main_db"]["db"]); ## PHP 7 사용불가    $sql = "SHOW TABLES like '".$tblid."'";    $Table_exist = mysqli_query($GLOBALS['dblink'], $sql);    if (!$Table_exist) {        jsMsg("테이블 선택 실패");        //jsHistory("-1") ;    }    $Table_Num = mysqli_num_rows($Table_exist);    if($Table_Num>0){        jsMsg("이미 사용중인 테이블 입니다.");        jsHistory("-1") ;        exit();    }      //게시판 정보 테이블에 입력    $sql = "INSERT INTO ".$GLOBALS["_conf_tbl"]["board_info"]." set 		boardid='$boardid',		wdate=now()	";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_affected_rows($GLOBALS['dblink']);    if($total > 0){        //게시판 테이블 생성        $sql = "CREATE TABLE $tblid (			idx int(10) unsigned NOT NULL auto_increment COMMENT '일련번호',			no tinyint(1) unsigned DEFAULT '1' NOT NULL COMMENT '정렬용 번호',			main int(10) unsigned DEFAULT '99999999' NOT NULL COMMENT '원글번호',			sub tinyint(3) unsigned DEFAULT '0' NOT NULL COMMENT '답글위치',			depth tinyint(3) unsigned DEFAULT '0' NOT NULL COMMENT '답글깊이',			w_user varchar(100) COMMENT '글쓴사람',			r_user varchar(100) COMMENT '답글쓴사람',			name varchar(50) COMMENT '작성자명',			pass varchar(255) COMMENT '비밀번호',			homepage varchar(255) COMMENT '홈페이지',			tel varchar(100) COMMENT '연락처',			fax varchar(100) COMMENT '팩스',			email varchar(255) COMMENT '이메일',			subject varchar(255) COMMENT '제목',			contents mediumtext COMMENT '내용',			usereplyemail enum('Y','N') NOT NULL default 'N' COMMENT '답변시 메일받음',			usehtml enum('Y','N') NOT NULL default 'N' COMMENT 'HTML 사용',			category varchar(50) COMMENT '게시판 카테고리',			uselock enum('Y','N') NOT NULL default 'N' COMMENT '글잠금',			is_show enum('Y','N') NOT NULL default 'N' COMMENT '노출 여부',			is_notice enum('Y','N') NOT NULL default 'N' COMMENT '메인 노출 여부',			hit int(10) COMMENT '조회수',			b_sort int(10) DEFAULT '0' NOT NULL COMMENT '순서',			etc_1 varchar(255) COMMENT '여분필드1',			etc_2 varchar(255) COMMENT '여분필드2',			etc_3 varchar(255) COMMENT '여분필드3',			etc_4 varchar(255) COMMENT '여분필드4',			etc_5 varchar(255) COMMENT '여분필드5',			etc_6 varchar(255) COMMENT '여분필드6',			etc_7 varchar(255) COMMENT '여분필드7',			etc_8 varchar(255) COMMENT '여분필드8',			etc_9 varchar(255) COMMENT '여분필드9',			etc_10 varchar(255) COMMENT '여분필드10',			ip varchar(24) COMMENT 'IP주소',			schedule_date DATE NOT NULL DEFAULT '0000-00-00' COMMENT '스케줄일정',			wdate DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '작성일',			PRIMARY KEY (idx),			KEY no (no, main, sub)		)";		        $rs = mysqli_query($GLOBALS['dblink'], $sql);        if($rs){            return true;        }else{            //위에서 입력한 게시판 정보 삭제            $sql = "delete from ".$GLOBALS["_conf_tbl"]["board_info"]." where boardid='$boardid' ";            mysqli_query($GLOBALS['dblink'], $sql);            return false;        }    }else{        jsMsg("게시판 정보 테이블 입력실패");        return false;    }}## 산업평가 복사function copyBoardEva($pidx){    $tbl = $GLOBALS["_SITE"]["BOARD_PREWORD"]."evaluation";    //main 번호 가져오기    $q_main = mysqli_query($GLOBALS['dblink'],"select min(main) from $tbl ");    $c_main = @mysqli_result($q_main,0,0);    if(!$c_main){        $main='99999999';    }else{        $main=$c_main-1;    }    $sql = "INSERT INTO ".$tbl." (NO,main,sub,depth,w_user,r_user,name,pass,homepage,tel,fax,email,subject,contents,usereplyemail,usehtml,category,uselock,hit,b_sort,etc_1,etc_2,etc_3,etc_4,etc_5,ip,schedule_date,wdate,date_y,accept1_sdate,accept1_edate,accept2_sdate,accept2_edate,evaluation1_sdate,evaluation1_edate,publication1_date,publication1_time,evaluation2_sdate,evaluation2_edate,publication2_date,publication2_time,price,account_info,reply_date,pay1_f_edate,pay1_f_time,pay1_l_sdate,pay1_l_edate,pay1_l_time,pay2_f_sdate,pay2_f_edate,pay2_f_time,pay2_l_sdate,pay2_l_edate,pay2_l_time,item_name,item_note,item_title,item_show,cont_text01,cont_text02,cont_text03,cont_text04,cont_text05,cont_text06,cont_text07,cont_text08,cont_text09,cont_text10,cont_text11,cont_text12,cont_text13,cont_text14,cont_text15,cont_text16,cont_text17,cont_text18,cont_text19,cont_text20,img1_title,img2_title,img3_title,img4_title,img1_note,img2_note,img3_note,img4_note,site1_subject,site1_link,site2_subject,site2_link,site3_subject,site3_link,site4_subject,site4_link,view_1,view_2,view_3)	SELECT NO,'".$main."' AS main,sub,depth,w_user,r_user,name,pass,homepage,tel,fax,email,subject,contents,usereplyemail,usehtml,category,uselock,hit,b_sort,etc_1,etc_2,etc_3,etc_4,etc_5,ip,schedule_date,wdate,date_y,accept1_sdate,accept1_edate,accept2_sdate,accept2_edate,evaluation1_sdate,evaluation1_edate,publication1_date,publication1_time,evaluation2_sdate,evaluation2_edate,publication2_date,publication2_time,price,account_info,reply_date,pay1_f_edate,pay1_f_time,pay1_l_sdate,pay1_l_edate,pay1_l_time,pay2_f_sdate,pay2_f_edate,pay2_f_time,pay2_l_sdate,pay2_l_edate,pay2_l_time,item_name,item_note,item_title,item_show,cont_text01,cont_text02,cont_text03,cont_text04,cont_text05,cont_text06,cont_text07,cont_text08,cont_text09,cont_text10,cont_text11,cont_text12,cont_text13,cont_text14,cont_text15,cont_text16,cont_text17,cont_text18,cont_text19,cont_text20,img1_title,img2_title,img3_title,img4_title,img1_note,img2_note,img3_note,img4_note,site1_subject,site1_link,site2_subject,site2_link,site3_subject,site3_link,site4_subject,site4_link,view_1,view_2,view_3 FROM ".$tbl." WHERE idx=".$pidx;    //echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    if($rs){        return true;    }else{        return false;    }}function editBoard($arrData){    //게시판 데이터 수정    $sql = "UPDATE ".$GLOBALS["_conf_tbl"]["board_info"]." SET		boardname='".$arrData['f_boardname']."', 		skin='".$arrData['f_skin']."', 		scale='".$arrData['f_scale']."', 		pagescale='".$arrData['f_pagescale']."', 		widthscale='".$arrData['f_widthscale']."', 		thumwidth='".$arrData['f_thumwidth']."', 		newmark='".$arrData['f_newmark']."', 		besthit='".$arrData['f_besthit']."', 		subjectcut='".$arrData['f_subjectcut']."', 		useadminonly='".$arrData['f_useadminonly']."', 		useintranet='".$arrData['f_intranet']."', 		usepds='".$arrData['f_usepds']."', 		usereply='".$arrData['f_usereply']."', 		usememo='".$arrData['f_usememo']."', 		uselock='".$arrData['f_uselock']."', 		readlevel='".$arrData['f_readlevel']."', 		writelevel='".$arrData['f_writelevel']."', 		replylevel='".$arrData['f_replylevel']."', 		listlevel='".$arrData['f_listlevel']."', 		category='".str_replace(" ","",$arrData['f_category'])."', 		header='".$arrData['f_header']."', 		footer='".$arrData['f_footer']."' 		WHERE idx='".$arrData['idx']."' 	";    // echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    if($rs){        return true;    }else{        return false;    }}function deleteBoard($idx){    //게시판 정보 가져오기    $arrInfo = getArticleInfo($GLOBALS["_conf_tbl"]["board_info"], $idx);    if($arrInfo["total"] > 0){        $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $arrInfo["list"][0]["boardid"];        //게시판 정보 삭제        $sql = "DELETE FROM ".$GLOBALS["_conf_tbl"]["board_info"]." WHERE idx='".$idx."'	";        //echo $sql;        $rs1 = mysqli_query($GLOBALS['dblink'], $sql);        //게시판 테이블 삭제        $sql = "DROP TABLE ".$tblid;        $rs2 = mysqli_query($GLOBALS['dblink'], $sql);        //파일 테이블 정보 삭제        $sql = "DELETE FROM ".$GLOBALS["_conf_tbl"]["board_files"]." WHERE boardid='".$arrInfo["list"][0]["boardid"]."'	";        $rs3 = mysqli_query($GLOBALS['dblink'], $sql);        //댓글 삭제        mysqli_query($GLOBALS['dblink'], "DELETE FROM ".$GLOBALS["_conf_tbl"]["comment"]." WHERE boardid='".$arrInfo["list"][0]["boardid"]."'");        if($rs1 && $rs2 &&$rs3){            return true;        }else{            return false;        }    }else{        return false;    }}// 헤더부분만 변경function editBoardHeader($boardid){    //게시판 데이터 수정    $sql = "UPDATE ".$GLOBALS["_conf_tbl"]["board_info"]." SET		header='".mysqli_real_escape_string($GLOBALS["dblink"],$_POST['header'])."'		WHERE boardid='".mysqli_real_escape_string($GLOBALS["dblink"],$_POST['boardid'])."' 	";    // echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    if($rs){        return true;    }else{        return false;    }}/*********************************** 게시판 관리 *************************************//*********************************** 게시물관련 *************************************///게시판 설정정보 가져오기function getBoardInfo($tbl, $boardid){    $sql  = "SELECT * ";    $sql .= "FROM ".$GLOBALS["_conf_tbl"]["board_info"]." ";    $sql .= "WHERE boardid = '$boardid' ";//echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        for($i=0; $i < $total_rs; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}// 원래 모든 카테고리를 반환하는 함수function getCategoryAll() {	$sql = "SELECT c_code, c_name FROM " . $GLOBALS["_conf_tbl"]["categories_poly"];	$rs = mysqli_query($GLOBALS['dblink'], $sql);	$total_rs = mysqli_num_rows($rs);	if($total_rs > 0) {		$list['total'] = $total_rs;		for($i=0; $i < $total_rs; $i++) {			$list['list'][$i] = mysqli_fetch_assoc($rs);		}	} else {		$list['total'] = 0;	}	return $list;}// 특정 코드에 대한 카테고리 이름을 반환하는 함수function getCategoryName($code='') {	if(empty($code)) return '';	$sql = "SELECT c_name FROM " . $GLOBALS["_conf_tbl"]["categories_poly"] . " WHERE c_code = '" . mysqli_real_escape_string($GLOBALS['dblink'], $code) . "' LIMIT 1";	$rs = mysqli_query($GLOBALS['dblink'], $sql);	if(mysqli_num_rows($rs) > 0) {		$row = mysqli_fetch_assoc($rs);		return $row['c_name'];	} else {		return $code; // 해당 코드가 없으면 원래 코드 반환	}}function getCategoryOption($code) {	$sql = "SELECT c_code, c_name FROM " . $GLOBALS["_conf_tbl"]["categories_poly"];	if(!empty($code)) {		$sql .= " WHERE c_category = '" . mysqli_real_escape_string($GLOBALS['dblink'], $code) . "'";	}	$rs = mysqli_query($GLOBALS['dblink'], $sql);	$total_rs = mysqli_num_rows($rs);	$arrCategory = array();	if($total_rs > 0) {		for($i=0; $i < $total_rs; $i++) {			$row = mysqli_fetch_assoc($rs);			$arrCategory[$row['c_code']] = $row['c_name'];		}	}	return $arrCategory;}// account_paid 테이블에서 구독회원 정보 가져오기function getPaidSubscription($p_mid) {	$sql = "SELECT p_paid FROM " . $GLOBALS["_conf_tbl"]["account_paid_poly"] . "            WHERE p_item = '구독회비'            AND p_mid = '" . mysqli_real_escape_string($GLOBALS['dblink'], $p_mid) . "'            ORDER BY p_paid DESC            LIMIT 1";	$rs = mysqli_query($GLOBALS['dblink'], $sql);	if(mysqli_num_rows($rs) > 0) {		$row = mysqli_fetch_assoc($rs);		return $row['p_paid']; // 최근 날짜만 바로 반환	} else {		return null; // 데이터가 없을 경우 null 반환	}}//게시물 가져오기 - 파일 제외function getBoardListBase($boardid, $category, $sw="", $sk="", $scale, $offset=0, $subQuery="", $orderby=""){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //카테고리가 있을경우    if($category !=""){        $que_category = " and category='$category' ";    }    if($_GET['sk2']){        switch($_GET['sw2']){            case("n") :                $q_limit = "and name like '%".$_GET['sk2']."%'";                break;            case("h") :                $q_limit = "and homepage like '%".$_GET['sk2']."%'";                break;            case("e2") :                $q_limit = "and etc_2 like '%".$_GET['sk2']."%'";                break;        }    }    //검색키워드가 있을경우    if($sk !=""){        switch($sw){            case("idx") :                $que_where = "and idx in (".$sk.") ";                break;            case("n") :                $que_where = "and name like '%$sk%'";                break;            case("s") :                $que_where = "and subject like '%$sk%'";                break;            case("shipping") :                $que_where = "and subject like '%$sk%'";                break;            case("h") :                $que_where = "and homepage like '%$sk%'";                break;            case("hg") :                $que_where = "and homepage='$sk'";                break;            case("e1") :                $que_where = "and etc_1 = '$sk'";                break;            case("e2") :                $que_where = "and etc_2 = '$sk'";                break;            case("e3") :                $que_where = "and etc_3 like '%$sk%'";                break;            case("e4") :                $que_where = "and etc_4 = '$sk'";                break;            case("c") :                $que_where = "and contents like '%$sk%'";                break;            case("u_id") :                $que_where = "and w_user = '$sk'";                break;            case("r_id") :                $que_where = "and r_user = '$sk'";                break;            case("ko_company") :                $que_where = "and ko_company like '%$sk%'";                break;            case("schedule_date") :                $que_where = "and schedule_date like '%$sk%'";                break;            case("a") :            default :                $que_where = "and (name like '%$sk%' or subject like '%$sk%' or contents like '%$sk%' or w_user like '%$sk%' or etc_3 like '%$sk%')";        }    }    if($_REQUEST['sk2'] && $sw=="shipping"){        $que_where .= " AND contents like '%".$_REQUEST['sk2']."%' ";    }    if($_REQUEST['scsdate']){        $que_where .= " AND schedule_date >= '".mysqli_real_escape_string($GLOBALS['dblink'], $_REQUEST['scsdate'])."' ";    }    if($_REQUEST['scedate']){        $que_where .= " AND schedule_date <= '".mysqli_real_escape_string($GLOBALS['dblink'], $_REQUEST['scedate'])."' ";    }    if($subQuery){        $que_where .= $subQuery;    }    //카운트    $sql = "select count(idx) from $tblid WHERE 1=1 $q_limit $que_where $que_category ";//	echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $row = mysqli_fetch_row($rs);    $total_rs = $row[0];    //목록    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    //$sql .= "WHERE no='1' $q_limit $que_where $que_category ";    $sql .= "WHERE 1=1 $q_limit $que_where $que_category ";    if($total_rs > 0){        $list['total'] = $total_rs;        // 페이지 네비게이션 오프셋 지정.        if(!$offset){            $offset=0;        }else{            $offset=$offset;        }        // offset 이 전체 게시물수보다 작을때 offset 을 전체게시물 - 페이지당 보여줄 글 수로 offset 설정        if($total_rs<=$offset){            $offset = $total_rs - $scale;        }        if($boardid == "audio") {	# 오디오 도슨트            if($scale > 0){                $sql .= " order by hit asc, idx asc limit $offset,$scale ";            }else{                $sql .= " order by hit asc, idx asc";            }        }else if($boardid == "place") {	# 순서가 필요한 테이블            if($scale > 0){                $sql .= " order by b_sort desc,idx asc limit $offset,$scale ";            }else{                $sql .= " order by b_sort desc,idx asc";            }        }else if($orderby){            if($scale > 0){                $sql .= $orderby." limit $offset,$scale ";            }else{                $sql .= $orderby;            }        }else if($boardid == "business" || $boardid == "notice" || $boardid == "subcontractor" || $boardid == "office") {	#            if($scale > 0){                $sql .= " order by schedule_date desc,idx desc limit $offset,$scale ";            }else{                $sql .= " order by schedule_date desc,idx desc";            }        }else{            if($scale > 0){                $sql .= " order by idx desc limit $offset,$scale ";            }else{                $sql .= " order by idx desc";            }        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        //	echo $sql;        // offset 을 이용한 limit 가 적용된 갯수        $total = mysqli_num_rows($rs);        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//게시물 가져오기 - 스케줄 형식function getBoardListSchedule($boardid, $s_date, $e_date){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //목록    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    $sql .= "WHERE schedule_date >= '$s_date' AND  schedule_date <= '$e_date' ";    $sql .= " order by no, main, sub ";    //echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_num_rows($rs);    $list['list']['total'] = $total;    for($i=0; $i < $total; $i++){        $row = mysqli_fetch_assoc($rs);        $list['list'][$row['schedule_date']][] = $row;    }    return $list;}//게시물 가져오기 - 스케줄 형식function getBoardScheduleCnt($boardid, $s_date, $e_date, $subject, $idx){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //목록    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    $sql .= "WHERE schedule_date >= '$s_date' AND  schedule_date <= '$e_date' AND subject = '$subject' ";    if($idx){        $sql .= " AND idx != $idx ";    }    $sql .= " order by no, main, sub ";    //echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_num_rows($rs);    $list['list']['total'] = $total;    for($i=0; $i < $total; $i++){        $row = mysqli_fetch_assoc($rs);        $list['list'][$row[schedule_date]][] = $row;    }    return $list;}//게시물 가져오기 - 스케줄 형식function getBoardListScheduleBooking($boardid, $s_date, $e_date, $adminid=""){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //목록    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    $sql .= "WHERE schedule_date >= '$s_date' AND  schedule_date <= '$e_date' AND length(etc_2)>0 ";    if($adminid){        $sql .= " AND admin_idx = '$adminid' ";    }    $sql .= " order by no, main, sub ";    //echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_num_rows($rs);    $list['list']['total'] = $total;    for($i=0; $i < $total; $i++){        $row = mysqli_fetch_assoc($rs);        $list['list'][$row['schedule_date']][] = $row;    }    return $list;}//게시물 가져오기 - 스케줄 형식function getBoardListScheduleCalculate($boardid, $s_date, $e_date, $adminid=""){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //목록    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    $sql .= "WHERE schedule_date >= '$s_date' AND  schedule_date <= '$e_date' AND length(etc_2)>0 ";    if($adminid){        $sql .= " AND admin_idx = '$adminid' ";    }    $sql .= " order by no, main, sub ";    //echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_num_rows($rs);    $list['list']['total'] = $total;    for($i=0; $i < $total; $i++){        $row = mysqli_fetch_assoc($rs);        $list['list'][$row['schedule_date']][] = $row;    }    return $list;}//게시물 가져오기 - 스케줄 형식function getBoardListScheduleList($boardid = null, $s_date, $e_date) {    // 모든 보드 타입과 관련 설정을 정의    $boardTypes = [        'edu' => [            'table' => $GLOBALS["_SITE"]["BOARD_PREWORD"] . "edu",            'start_field' => 'e_start_date',            'end_field' => 'e_end_date',            'type' => 'education'        ],        'video' => [            'table' => $GLOBALS["_SITE"]["BOARD_PREWORD"] . "video",            'start_field' => 'screening_date',            'end_field' => 'screening_date',            'type' => 'video'        ],        'equ_applicants' => [            'table' => $GLOBALS["_SITE"]["BOARD_PREWORD"] . "equ_applicants",            'start_field' => 'rental_start_date',            'end_field' => 'rental_end_date',            'type' => 'equipment'        ],        'place_applicants' => [            'table' => $GLOBALS["_SITE"]["BOARD_PREWORD"] . "place_applicants",            'start_field' => 'rental_date',            'end_field' => 'rental_date',            'type' => 'place'        ],        'media_applicants' => [            'table' => $GLOBALS["_SITE"]["BOARD_PREWORD"] . "media_applicants",            'start_field' => 'desired_date',            'end_field' => 'desired_date',            'type' => 'media'        ]    ];    $list = ['list' => ['total' => 0]];    // 특정 보드 ID가 제공된 경우    if ($boardid !== null && isset($boardTypes[$boardid])) {        $boardsToProcess = [$boardid => $boardTypes[$boardid]];    } else {        // 모든 보드 처리        $boardsToProcess = $boardTypes;    }    // 각 보드 타입에 대해 처리    foreach ($boardsToProcess as $currentBoardId => $boardConfig) {        $sql = "SELECT *, '{$boardConfig['type']}' as schedule_type ";        $sql .= "FROM {$boardConfig['table']} ";        $sql .= "WHERE ({$boardConfig['start_field']} <= '$e_date' AND {$boardConfig['end_field']} >= '$s_date') ";        $sql .= "ORDER BY no, main, sub ";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        if (!$rs) {            continue; // 쿼리 실패시 다음 보드로 진행        }        $total = mysqli_num_rows($rs);        $list['list']['total'] += $total;        while ($row = mysqli_fetch_assoc($rs)) {            $start_date = new DateTime($row[$boardConfig['start_field']]);            $end_date = new DateTime($row[$boardConfig['end_field']]);            // 종료일이 시작일보다 이전인 경우 처리            if ($end_date < $start_date) {                $temp = $start_date;                $start_date = $end_date;                $end_date = $temp;            }            $interval = new DateInterval('P1D');            $date_range = new DatePeriod($start_date, $interval, $end_date->modify('+1 day'));            // edu 테이블일 경우 요일 체크            if ($currentBoardId === 'edu' && !empty($row['days'])) {                $allowed_days = explode('|', $row['days']);                $day_map = ['월'=>'Monday', '화'=>'Tuesday', '수'=>'Wednesday',                    '목'=>'Thursday', '금'=>'Friday', '토'=>'Saturday', '일'=>'Sunday'];                foreach ($date_range as $date) {                    $dayOfWeek = $date->format('l'); // 영문 요일                    $koreanDayOfWeek = array_search($dayOfWeek, $day_map);                    // 허용된 요일인 경우만 추가                    if (in_array($koreanDayOfWeek, $allowed_days)) {                        $dateStr = $date->format('Y-m-d');                        $row['schedule_source'] = $currentBoardId;                        $list['list'][$dateStr][] = $row;                    }                }            } else {                // 다른 테이블은 기존 로직 유지                foreach ($date_range as $date) {                    $dateStr = $date->format('Y-m-d');                    $row['schedule_source'] = $currentBoardId;                    $list['list'][$dateStr][] = $row;                }            }        }    }    return $list;}//게시물 가져오기 - 파일 포함function getBoardListBaseNFile($boardid, $category, $sw="", $sk="", $scale, $offset=0, $subQuery="", $reply="", $orderBy=""){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $q_limit	= "";    $que_where	= "";    $que_category	= "";    $que_etc	= "";    //카테고리가 있을경우    if($category !=""){        $que_category = " and A.category like '%$category%'";    }    if($_GET['etc_1']){        $que_etc .= " and A.etc_1='".$_GET['etc_1']."' ";    }    if($_GET['etc_2']){        $que_etc .= " and A.etc_2='".$_GET['etc_2']."' ";    }    if($_GET['etc_3']){        $que_etc .= " and A.etc_3='".$_GET['etc_3']."' ";    }    if($_GET['date_y']){        $que_etc .= " and A.date_y='".$_GET['date_y']."' ";    }    if($_GET['category2']){        $que_etc .= " and A.category2='".$_GET['category2']."' ";    }    if($_GET['category1']){        $que_etc .= " and A.category1='".$_GET['category1']."' ";    }    if($_GET['status']){        $que_etc .= " and A.status='".$_GET['status']."' ";    }    if($_GET['board_type']){        $que_where .= " and A.board_type like '%{$_GET['board_type']}%'";    }    //검색키워드가 있을경우$arrBoardList["list"][$i]['video_no']    if($sk !=""){        switch($sw){            case("all") :                $que_where = "and (A.subject like '%$sk%' or A.name like '%$sk%' or A.w_user like '%$sk%' or A.tel like '%$sk%')";                break;            case("subject") :                $que_where = "and A.subject like '%$sk%'";                break;            case("status") :                $que_where = "and A.status like '%$sk%'";                break;            case("n") :                $que_where = "and A.name like '%$sk%'";                break;            case("username") :                $que_where = "and (A.name like '%$sk%' or A.etc_2 like '%$sk%' or A.etc_3 like '%$sk%')";                break;            case("mixed") :                $que_where = "and (A.subject like '%$sk%' or A.etc_6 like '%$sk%' or A.etc_7 like '%$sk%' or A.etc_8 like '%$sk%')";                break;            case("tel") :                $que_where = "and A.tel like '%$sk%'";                break;            case("order") :                $que_where = "and (A.etc_1 like '%$sk%' or A.subject like '%$sk%' ) ";                break;            case("s") :                $que_where = "and A.subject like '%$sk%'";                break;            case("idx") :                $que_where = "and A.idx = '$sk'";                break;            case("sd") :                $que_where = "and A.schedule_date like '%$sk%'";                break;            case("h") :                $que_where = "and A.homepage like '%$sk%'";                break;            case("bday") :                $que_where = "and A.bday like '%$sk%'";                break;            case("e") :                $que_where = "and A.etc_1 = '$sk'";                break;            case("e3") :                $que_where = "and A.etc_3 = '$sk'";                break;            case("e1l") :                $que_where = "and A.etc_1 like '%$sk%'";                break;            case("e2l") :                $que_where = "and A.etc_2 like '%$sk%'";                break;            case("e3l") :                $que_where = "and A.etc_3 like '%$sk%'";                break;            case("e4l") :                $que_where = "and A.etc_4 like '%$sk%'";                break;            case("e5l") :                $que_where = "and A.etc_5 like '%$sk%'";                break;            case("cate") :                $que_where = "and A.category like '%$sk%'";                break;            case("e4") :                $que_where = "and A.etc_4 = '$sk'";                break;            case("arridx") :                $que_where = "and A.idx in ($sk) ";                break;            case("userid") :                $que_where = "and A.w_user like '%$sk%'";                break;            case("wuser") :                $que_where = "and A.w_user ='$sk' ";                break;            case("search") :                $que_where = "and A.tel = '". $_SESSION["MEMBER"]["HP"] ."' and A.email = '". $_SESSION["MEMBER"]["EMAIL"] ."' ";                break;            case("apply") :			## 참가업체 전체 검색                $que_where = "and ( A.ko_company like '%$sk%' OR A.registration like '%$sk%' OR A.ko_ceo like '%$sk%' OR A.user1_name like '%$sk%')";                break;            case("apply_user") :	## 참관객 전체 검색                $que_where = "and ( A.ko_company like '%$sk%' OR A.user_name like '%$sk%' OR A.user_mobile like '%$sk%' OR A.email like '%$sk%')";                break;            case("user_name") :                $que_where = "and A.user_name like '%$sk%'";                break;            case("user_mobile") :                $que_where = "and A.user_mobile like '%$sk%'";                break;            case("email") :                $que_where = "and A.email like '%$sk%'";                break;            case("c") :                $que_where = "and A.contents like '%$sk%'";                break;            case("ruser") :                $que_where = "and A.r_user like '%$sk%'";                break;            case("a") :            default :                $que_where = "and (A.name like '%$sk%' or A.subject like '%$sk%' or A.contents like '%$sk%' or A.etc_3 like '%$sk%')";        }        // 검색시 영역을 분할하여 검색=> 속도향상용        $sql = "select count(A.idx) as cnt from $tblid A";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $row = mysqli_fetch_assoc($rs);        $q_total = $row['cnt'];        $q_start = $q_total - 10000; // 최근 10000건만 검색        if($q_total>10000){            $q_limit = " A.idx between " . $q_start . " and " . $q_total . " ";        }        // 검색시 영역을 분할하여 검색=> 속도향상용    }    if($reply == "admin"){    }else if($reply == "user"){        if($_REQUEST['s_date']){            $que_where .= " AND A.wdate >= '".mysqli_real_escape_string($GLOBALS['dblink'], $_REQUEST['s_date'])." 00:00:00' ";        }        if($_REQUEST['e_date']){            $que_where .= " AND A.wdate <= '".mysqli_real_escape_string($GLOBALS['dblink'], $_REQUEST['e_date'])." 23:59:59' ";        }        if($_REQUEST['scsdate']){            $que_where .= " AND A.schedule_date >= '".mysqli_real_escape_string($GLOBALS['dblink'], $_REQUEST['scsdate'])."' ";        }        if($_REQUEST['scedate']){            $que_where .= " AND A.schedule_date <= '".mysqli_real_escape_string($GLOBALS['dblink'], $_REQUEST['scedate'])."' ";        }    }    if($subQuery){        $que_where .= $subQuery;    }    $fileDB= $GLOBALS["_conf_tbl"]["board_files"];    //목록    $sql  = " SELECT A.*, B.idx AS f_idx, B.boardid, B.b_idx, B.ori_name, B.re_name, B.type, B.size ";    if ($boardid == "equ_applicants_cart"){        $sql .= " FROM $tblid A LEFT JOIN ".$fileDB." B ON B.boardid='equ' AND A.equ_idx=B.b_idx";    }else{        $sql .= " FROM $tblid A LEFT JOIN ".$fileDB." B ON B.boardid='$boardid' AND A.idx=B.b_idx";    }    $sql .= " WHERE 1=1 $q_limit $que_where $que_category $que_etc group by A.idx";    //조회 부분    //echo "echo:"; print_r($sql); echo "<br>" ;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        // 페이지 네비게이션 오프셋 지정.        if(!$offset){            $offset=0;        }else{            $offset=$offset;        }        // offset 이 전체 게시물수보다 작을때 offset 을 전체게시물 - 페이지당 보여줄 글 수로 offset 설정        if($total_rs<=$offset){            $offset = $total_rs - $scale;        }        //scale 0 으로 지정시에는 전체 가져옴        if($orderBy){            $sql .= $orderBy;        }else if($_GET['rdnm'] && $_GET['rdsc']){            if($scale > 0){                $sql .= " order by ".$_GET['rdnm']." ".$_GET['rdsc']." limit $offset,$scale ";            }else{                $sql .= " order by ".$_GET['rdnm']." ".$_GET['rdsc']." ";            }        }else{            if( $reply =="main") {	# 공지사항                if($scale > 0){                    $sql .= " order by idx desc limit $offset,$scale ";                }else{                    $sql .= " order by idx desc";                }            }else{                if($scale > 0){                    $sql .= " order by no asc, idx desc limit $offset,$scale ";                }else{                    $sql .= " order by no asc, idx desc";                }            }        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        // offset 을 이용한 limit 가 적용된 갯수        $total = mysqli_num_rows($rs);        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//게시물 가져오기 - 댓글카운트 포함function getBoardListBaseNMemoCnt($boardid, $category, $sw="", $sk="", $scale, $offset=0){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $tbl_comment = $GLOBALS["_conf_tbl"]["comment"];    if($boardid == "after" && $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]) {        //	$que_where .= " or (w_user='".$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]."') ";    }    //카테고리가 있을경우    if($category !=""){        $que_category = " and category='$category' ";    }    if($_GET[user_id]) {        $que_where .= "and (w_user = '".$_GET[user_id]."' or schedule_date='0000-00-00') ";    } else if($boardid == "after" && $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["GRADE"]!="ROOT") {        $que_where .= " and schedule_date!='0000-00-00'";    }    //검색키워드가 있을경우    if($sk !=""){        switch($sw){            case("n") :                $que_where .= "and name like '%$sk%'";                break;            case("s") :                $que_where .= "and subject like '%$sk%'";                break;            case("c") :                $que_where .= "and contents like '%$sk%'";                break;            case("e") :                $que_where .= "and etc_1 = '$sk'";                break;            case("sp") :                $que_where = "and schedule_date = '0000-00-00'";                break;            case("a") :            default :                $que_where .= "and (name like '%$sk%' or subject like '%$sk%' or contents like '%$sk%')";        }        // 검색시 영역을 분할하여 검색=> 속도향상용        $sql = "select count(idx) as cnt from $tblid ";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $row = mysqli_fetch_assoc($rs);        $q_total = $row[cnt];        $q_start = $q_total - 10000; // 최근 10000건만 검색        if($q_total>10000){            $q_limit = " idx between " . $q_start . " and " . $q_total . " ";        }        // 검색시 영역을 분할하여 검색=> 속도향상용    }    //카운트    //$sql = "select count(idx) from $tblid WHERE no='1' $q_limit $que_where $que_category $que_catcode ";    $sql = "select count(idx) from $tblid WHERE 1=1 $q_limit $que_where $que_category $que_catcode ";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $row = mysqli_fetch_row($rs);    $total_rs = $row[0];    //목록    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    //$sql .= "WHERE no='1' $q_limit $que_where $que_category $que_catcode ";    $sql .= "WHERE 1=1 $q_limit $que_where $que_category $que_catcode ";    if($total_rs > 0){        $list['total'] = $total_rs;        // 페이지 네비게이션 오프셋 지정.        if(!$offset){            $offset=0;        }else{            $offset=$offset;        }        // offset 이 전체 게시물수보다 작을때 offset 을 전체게시물 - 페이지당 보여줄 글 수로 offset 설정        if($total_rs<=$offset){            $offset = $total_rs - $scale;        }        //scale 0 으로 지정시에는 전체 가져옴        if($scale > 0){            $sql .= " order by no, main, sub limit $offset,$scale ";        }else{            $sql .= " order by no, main, sub ";        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        //echo $sql;        // offset 을 이용한 limit 가 적용된 갯수        $total = mysqli_num_rows($rs);        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);            $m_cnt_row = mysqli_fetch_row(mysqli_query("select count(idx) from $tbl_comment WHERE boardid='$boardid' AND board_idx='".$list['list'][$i][idx]."' "));            $list['list'][$i][cmt_count] = $m_cnt_row[0];        }    }else{        $list['total'] = 0;    }    return $list;}//게시물 가져오기 - 파일 포함function getBoardListBaseNImage($boardid, $category, $sw="", $sk="", $scale, $offset=0){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //카테고리가 있을경우    if($category !=""){        $que_category = " and A.category='$category' ";    }    //검색키워드가 있을경우    if($sk !=""){        switch($sw){            case("n") :                $que_where = "and A.name like '%$sk%'";                break;            case("s") :                $que_where = "and A.subject like '%$sk%'";                break;            case("c") :                $que_where = "and A.contents like '%$sk%'";                break;            case("e") :                $que_where = "and etc_1 = '$sk'";                break;            case("a") :            default :                $que_where = "and (A.name like '%$sk%' or A.subject like '%$sk%' or A.contents like '%$sk%')";        }        // 검색시 영역을 분할하여 검색=> 속도향상용        $sql = "select count(A.idx) as cnt from $tblid A";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $row = mysqli_fetch_assoc($rs);        $q_total = $row[cnt];        $q_start = $q_total - 10000; // 최근 10000건만 검색        if($q_total>10000){            $q_limit = " A.idx between " . $q_start . " and " . $q_total . " ";        }        // 검색시 영역을 분할하여 검색=> 속도향상용    }    //카운트//	$sql = "select count(A.idx) from $tblid A WHERE A.no='1' $q_limit $que_where $que_category ";    $sql = "select count(A.idx) from $tblid A WHERE 1=1 $q_limit $que_where $que_category ";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $row = mysqli_fetch_row($rs);    $total_rs = $row[0];    //목록    $sql  = "SELECT A.*, B.idx AS f_idx, B.boardid, B.b_idx, B.ori_name, B.re_name, B.type, B.size ";    $sql .= "FROM $tblid A LEFT JOIN ".$GLOBALS["_conf_tbl"]["board_files"]." B ON B.boardid='$boardid' AND A.idx=B.b_idx AND B.ext IN('jpg','gif','png')";//    $sql .= "WHERE A.no='1' $q_limit $que_where $que_category group by A.idx";    $sql .= "WHERE 1=1 $q_limit $que_where $que_category group by A.idx";    //echo $sql;    if($total_rs > 0){        $list['total'] = $total_rs;        // 페이지 네비게이션 오프셋 지정.        if(!$offset){            $offset=0;        }else{            $offset=$offset;        }        // offset 이 전체 게시물수보다 작을때 offset 을 전체게시물 - 페이지당 보여줄 글 수로 offset 설정        if($total_rs<=$offset){            $offset = $total_rs - $scale;        }        //scale 0 으로 지정시에는 전체 가져옴        if($scale > 0){            $sql .= " order by A.no, A.main, A.sub limit $offset,$scale ";        }else{            $sql .= " order by A.no, A.main, A.sub ";        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        // offset 을 이용한 limit 가 적용된 갯수        $total = mysqli_num_rows($rs);        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}/** * 게시판 별 추가 SQL 생성 * @param string $boardid 게시판 ID * @param string $mode insert 또는 modify * @param array $postData $_POST 데이터 * @return string SQL 쿼리 문자열 */function getBoardCustomSql($boardid, $mode = 'insert', $postData = array()) {    $sub_sql = "";    // 게시판별 처리    switch($boardid) {        case 'qna':            if(isset($postData["etc_1"]) && !empty($postData["etc_1"])) {                $sub_sql .= "etc_2 = '" . mysqli_real_escape_string($GLOBALS['dblink'], !empty($postData['etc_2']) ? $postData['etc_2'] : $postData['name']) . "',";                $sub_sql .= "etc_3 = '" . mysqli_real_escape_string($GLOBALS['dblink'], !empty($postData['etc_3']) ? $postData['etc_3'] : date("Y-m-d")) . "',";            }            break;        case 'edu':            $sub_sql .= "reception_status = '".mysqli_real_escape_string($GLOBALS['dblink'], $postData['reception_status'])."',";            $sub_sql .= "instructor_idx = '".mysqli_real_escape_string($GLOBALS['dblink'], empty($postData['instructor_idx']) ? '0' : $postData['instructor_idx'])."',";            // insert와 modify에 따른 다른 처리            if($mode == 'insert') {                $sub_sql .= "instructor_idx = '".mysqli_real_escape_string($GLOBALS['dblink'],empty($_POST['instructor_idx']) ? '0' : $_POST['instructor_idx'])."', ";            } else {                $sub_sql .= "education_name = '".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['education_name'])."', ";                $sub_sql .= "instructor = '".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['instructor'])."', ";            }            break;        case 'evaluation':            // 특정 필드값 추가            if(isset($postData['eval_score'])) {                $sub_sql .= "eval_score = '".mysqli_real_escape_string($GLOBALS['dblink'], $postData['eval_score'])."',";            }            break;        // 다른 게시판 케이스 추가 가능    }    return $sub_sql;}//게시물 등록하기function insertBoardArticle($boardid, $thumwidth){    $sub_sql= "";    $hit = $_POST['hit']??0;    $contents = mysqli_real_escape_string($GLOBALS['dblink'], $_POST['contents'])??"";    $contents = str_replace("'","’",$contents);    $subject = mysqli_real_escape_string($GLOBALS['dblink'], $_POST['subject'])??"";    $subject = str_replace("'","’",$subject);    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //main 번호 가져오기    $q_main = mysqli_query($GLOBALS['dblink'],"select min(main) from $tblid ");    $c_main = @mysqli_result($q_main,0,0);    if(!$c_main){        $main='99999999';    }else{        $main=$c_main-1;    }    //게시판 공지 설정    if(mysqli_real_escape_string($GLOBALS['dblink'], $_POST['is_notice'])=="Y"){        $setNo = "0";    }else{        $setNo = "1";    }    if(isset($_POST['schedule_date'])) {        $sql_add = " schedule_date='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['schedule_date'])."', ";    } else {        $sql_add = " schedule_date=Curdate(), ";    }    $sql_add .= " wdate=now() ";    //게시판 테이블에 입력    if(!isset($_POST['usereplyemail'])){	$_POST['usereplyemail'] = "N"; }    if(!isset($_POST['usehtml'])){	$_POST['usehtml'] = "N"; }    if(!isset($_POST['uselock'])){	$_POST['uselock'] = "N"; }    if(!isset($_POST['is_notice']) || empty($_POST['is_notice']) ){	$_POST['is_notice'] = "N"; }    $etc_2 = mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_2'));    $etc_3 = mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_3'));    $etc_4 = mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_4'));    $etc_5 = mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_5'));    $pass = "";    if(isset($_POST['pass'])){        $pass = mysqli_real_escape_string($GLOBALS['dblink'], $_POST['pass']) ;	## 비밀번호 있을 경우 단방향 암호화    }    $tel = "";    if(isset($_POST['tel'])){        $tel = mysqli_real_escape_string($GLOBALS['dblink'], $_POST['tel']) ;	## 연락처    }    $email = "";    if($_POST['email']){        $email =  mysqli_real_escape_string($GLOBALS['dblink'], $_POST['email']);	##    }else{        $email =  mysqli_real_escape_string($GLOBALS['dblink'], $_POST['email1'])."@".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['email2']) ;	##    }    $category = "";    if (is_array($someVariable) || $someVariable instanceof Countable) {        $count = count($someVariable);    } else {        $count = 0;    }    //게시판 별 추가 SQL 생성    $sub_sql = getBoardCustomSql($boardid, 'insert', $_POST);    if($_POST['b_sort']){        $sub_sql .= "			b_sort		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['b_sort'])."',		";    }    $sql = "INSERT INTO ".$tblid." set 		no='$setNo',		main='$main',		sub='0',		depth='0',		w_user='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('w_user'))."',		r_user='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('r_user'))."',		name='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('name'))."',		pass='".$pass."',		homepage='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('homepage'))."',		tel='".$tel."',		email='".$email."',		subject='".$subject."',		contents='".$contents."',		usereplyemail='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['usereplyemail']) ."',		usehtml='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['usehtml'])."',				category='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['category'])."',				uselock='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['uselock'])."',		is_notice='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['is_notice'])."',		is_show='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['is_show'])."',		hit='".$hit."',		etc_1='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_1'))."',		etc_2='".$etc_2."',		etc_3='".$etc_3."',		etc_4='".$etc_4 ."',		etc_5='".$etc_5."',		etc_6='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_6'))."',		etc_7='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_7'))."',		etc_8='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_8'))."',		etc_9='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_9'))."',		etc_10='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_10'))."',		ip='".$_SERVER['REMOTE_ADDR']."',		". $sub_sql ." ". $sql_add ." ";//등록하기//	echo "echo:"; print_r($sql); echo "<br>" ;//	exit;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $insert_idx = mysqli_insert_id($GLOBALS['dblink']);    $total = mysqli_affected_rows($GLOBALS['dblink']);    //파일처리    inputBoardFiles($boardid, $insert_idx, $_FILES, $thumwidth);    if($total > 0){        if(($boardid == "terms" && $etc_2 == "Y") || ($boardid == "KCAintroduce" && $etc_2 == "Y")){            $update_sql = "update $tblid set etc_2 = 'N' where idx != '$insert_idx' and category = '".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('category'))."' ";            $update_rs = mysqli_query($GLOBALS['dblink'], $update_sql);        }        return $insert_idx;    }else{        return false;    }}//게시물 수정하기function modifyBoardArticle($boardid, $idx, $thumwidth){    // PHP 7    if(!isset($_POST["is_notice"])){	$_POST["is_notice"]=""; }    $sub_sql	= "";    $sql_add	= "";    $contents = mysqli_real_escape_string($GLOBALS['dblink'], $_POST['contents'])??"";    $contents = str_replace("'","’",$contents);    $subject = mysqli_real_escape_string($GLOBALS['dblink'], $_POST['subject'])??"";    $subject = str_replace("'","’",$subject);    if(!isset($_POST['is_notice']) || empty($_POST['is_notice']) ){	$_POST['is_notice'] = "N"; }    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //수정권한 설정    $modifyPerm = false;    //관리자는 그냥 통과    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["GRADE"]=="ROOT" || @in_array("board_manage",$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["AUTH"])){        if($_POST['boardid']=="request"){            $reply = mysqli_real_escape_string($GLOBALS['dblink'], $_POST['reply'])??"";            $reply = str_replace("'","’",$reply);            if(isset($_POST['rdate'])) {                $reply_add = " ,reply='".$reply."', rdate='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['rdate'])."' ";            } else {                $reply_add = " ,reply='".$reply."', rdate=now() ";            }        }        $modifyPerm = true;    }    //기존정보와 비밀번호를 비교    $arrArticleInfo = getArticleInfo($tblid, $idx);    if($arrArticleInfo["list"][0]["pass"] && ($arrArticleInfo["list"][0]["pass"]==trim($_POST['pass']) || password_verify(trim($_POST['pass']), $arrArticleInfo["list"][0]["pass"]))){        //	$modifyPerm = true;	//비밀번호 입력형식이면    }    // 본인아이디 확인    // 로그인 상태이고 로그인 아이디와 글 쓴 아이디가 같을 경우    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]==$arrArticleInfo["list"][0]["w_user"]){        $modifyPerm = true;    }    // 기업회원    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]==$arrArticleInfo["list"][0]["registration"]){        $modifyPerm = true;    }    // 관람객    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]==$arrArticleInfo["list"][0]["email"]){        $modifyPerm = true;    }    //권한받은자만 젒근    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["GRADE"]=="ACCEL" && @in_array("biz_manage",$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["AUTH"])){        $modifyPerm = true;    }    //게시판 공지 설정    if($_POST['is_notice']=="Y"){        $setNo = "0";    }else{        $setNo = "1";    }    if($modifyPerm==true){        //게시판 테이블 지정        $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;        if(isset($_POST['hit'])) {            $sql_add = " hit=".$_POST['hit'].", ";        }        if(isset($_POST['schedule_date'])) {            $sql_add .= " schedule_date='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['schedule_date'])."', ";        } else {            //	$sql_add .= " schedule_date=Curdate(), ";        }        /*        if(isset($_POST['wdate'])) {            $sql_add .= " wdate='".$_POST['wdate']."' ";        } else {            $sql_add .= " wdate=now() ";        }*/        $etc_2 = mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_2'));        $etc_3 = mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_3'));        $etc_4 = mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_4'));        $etc_5 = mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_5'));        $tel = "";        if(isset($_POST['tel'])){            $tel = mysqli_real_escape_string($GLOBALS['dblink'], $_POST['tel']) ;	## 연락처        }        $email = "";        if(isset($_POST['email'])){            $email =  mysqli_real_escape_string($GLOBALS['dblink'], $_POST['email']) ;	##        }        $category = "";        if (is_array($_POST['category'])) {            for ($i = 0; $i < count($_POST['category']); $i++) {                $category .= $comma . $_POST['category'][$i];                $comma = "|";            }        } else {            $category = $_POST['category'];        }        if($_POST['b_sort']){            $sub_sql .= "				b_sort		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['b_sort'])."',			";        }        //게시판 별 추가 SQL 생성        $sub_sql = getBoardCustomSql($boardid, 'modify', $_POST);        if($_POST['b_sort']){            $sub_sql .= "			b_sort		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['b_sort'])."',		";        }        $sql = "UPDATE ".$tblid." set 			no='".$setNo."',			r_user='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('r_user'))."',			name='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('name'))."',			homepage='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('homepage'))."',			subject='".$subject."',			contents='".$contents."',			tel='".$tel."',			email='".$email."',			category='".$category."',					etc_1='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_1'))."',			etc_2='".$etc_2."',			etc_3='".$etc_3."',			etc_4='".$etc_4."',			etc_5='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_5'))."',			etc_6='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_6'))."',			etc_7='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_7'))."',			etc_8='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_8'))."',			etc_9='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_9'))."',			etc_10='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_10'))."',			". $sub_sql . $sql_add ." 						is_notice='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['is_notice'])."',			is_show='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['is_show'])."'			WHERE idx='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('idx'))."'";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = mysqli_affected_rows($GLOBALS['dblink']);//      수정하기//		echo $sql;//		exit();        //파일삭제 코딩 시작 - 삭제체크 한것만 처리        if(isset($_POST['filedel'])){            for($i=0;$i<count($_POST['filedel']);$i++){                if($_POST['filedel'][$i]>0){                    $fileinfo = getArticleFileInfo($boardid, $_POST['idx'], $_POST['filedel'][$i]);                    //디비에서 파일정보 삭제                    mysqli_query($GLOBALS['dblink'], "DELETE FROM ".$GLOBALS["_conf_tbl"]["board_files"]." WHERE boardid='".$boardid."' AND idx='".$fileinfo["list"][0]['idx']."' ");                    //디스크에서 파일 삭제                    @unlink($GLOBALS["_SITE"]["BOARD_DATA"] . "/".$boardid."/".$fileinfo["list"][0]['re_name']);                }            }        }        //파일삭제 코딩 종료        //파일처리        //if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["ID"]) {        inputBoardFiles($boardid, $idx, $_FILES, $thumwidth);        //}        if($rs){            if(($boardid == "terms" && $etc_2 == "Y") || ($boardid == "KCAintroduce" && $etc_2 == "Y")){                $update_sql = "update $tblid set etc_2 = 'N' where idx != '$idx' and category = '".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('category'))."' ";                $update_rs = mysqli_query($GLOBALS['dblink'], $update_sql);            }            return true;        }else{            return false;        }    }else{        jsMsg("본인 글만 수정할 수 있습니다.".$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]."/".$arrArticleInfo["list"][0]["registration"]);        return false;    }}function modifyApplyAdmin($boardid, $idx, $thumwidth){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $comma = "";    for($i=0;$i<12;$i++){ $ext12 .= $comma.$_POST['ext12_'.sprintf('%02d', $i)]; $comma = ","; }    $comma = "";    for($i=0;$i<11;$i++){ $ext13 .= $comma.$_POST['ext13_'.sprintf('%02d', $i)]; $comma = ","; }    $comma = "";    for($i=0;$i<8;$i++){ $ext14 .= $comma.$_POST['ext14_'.sprintf('%02d', $i)]; $comma = ","; }    $comma = "";    for($i=0;$i<7;$i++){ $ext15 .= $comma.$_POST['ext15_'.sprintf('%02d', $i)]; $comma = ","; }    $comma = "";    for($i=0;$i<11;$i++){ $ext16 .= $comma.$_POST['ext16_'.sprintf('%02d', $i)]; $comma = ","; }    $comma = "";    for($i=0;$i<4;$i++){ $ext17 .= $comma.$_POST['ext17_'.sprintf('%02d', $i)]; $comma = ","; }    $comma = "";    for($i=0;$i<4;$i++){ $ext18 .= $comma.$_POST['ext18_'.sprintf('%02d', $i)]; $comma = ","; }    $sub_sql= "		registration		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['registration'])."',		ko_company			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['ko_company'])."',		en_company			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['en_company'])."',		ko_ceo				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['ko_ceo'])."',		en_ceo				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['en_ceo'])."',		zip					='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['zip'])."',		address				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['address'])."',		address_ext			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['address_ext'])."',		en_address			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['en_address'])."',		ceo_tel				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['ceo_tel'])."',		ceo_fax				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['ceo_fax'])."',		ceo_email			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['ceo_email'])."',		user1_division		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_division'])."',		user1_name			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_name'])."',		user1_position		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_position'])."',		user1_tel			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_tel'])."',		user1_mobile		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_mobile'])."',		user1_email			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_email'])."',		user1_zip			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_zip'])."',		user1_address		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_address'])."',		user1_address_ext	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user1_address_ext'])."',		user2_division		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user2_division'])."',		user2_name			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user2_name'])."',		user2_position		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user2_position'])."',		user2_tel			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user2_tel'])."',		user2_mobile		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user2_mobile'])."',		user2_email			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['user2_email'])."',		nation				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['nation'])."',		biz					='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['biz'])."',		ext12				='".mysqli_real_escape_string($GLOBALS['dblink'], $ext12)."',		ext13				='".mysqli_real_escape_string($GLOBALS['dblink'], $ext13)."',		ext14				='".mysqli_real_escape_string($GLOBALS['dblink'], $ext14)."',		ext15				='".mysqli_real_escape_string($GLOBALS['dblink'], $ext15)."',		ext16				='".mysqli_real_escape_string($GLOBALS['dblink'], $ext16)."',		ext17				='".mysqli_real_escape_string($GLOBALS['dblink'], $ext17)."',		ext18				='".mysqli_real_escape_string($GLOBALS['dblink'], $ext18)."',		booth1				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['booth1'])."',		booth2				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['booth2'])."',		booth3				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['booth3'])."',		booth4				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['booth4'])."',		booth5				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['booth5'])."',		pay					='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['pay'])."',		gongpay				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['gongpay'])."',	";    if($_POST['pass']){        $sub_sql .= "			pass	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['pass'])."',						";    }    $sub_sql .= "		specialDisTxt_ko	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['specialDisTxt_ko'])."',		specialDisTxt_en	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['specialDisTxt_en'])."',		specialDis			='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['specialDis'])."',		etcDisTxt_ko		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['etcDisTxt_ko'])."',		etcDisTxt_en		='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['etcDisTxt_en'])."',		etcDis				='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['etcDis'])."',					";    $sql = "UPDATE ".$tblid." set 		".$sub_sql."			homepage='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('homepage'))."',		etc_1='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_1'))."',		etc_2='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_2'))."',		etc_3='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_3'))."',		etc_4='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_4'))."',				etc_5='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('etc_5'))."'		WHERE idx='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('idx'))."'";    //	echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_affected_rows($GLOBALS['dblink']);    //파일삭제 코딩 시작 - 삭제체크 한것만 처리    if(isset($_POST['filedel'])){        for($i=0;$i<count($_POST['filedel']);$i++){            if($_POST['filedel'][$i]>0){                $fileinfo = getArticleFileInfo($boardid, $_POST['idx'], $_POST['filedel'][$i]);                //디비에서 파일정보 삭제                mysqli_query($GLOBALS['dblink'], "DELETE FROM ".$GLOBALS["_conf_tbl"]["board_files"]." WHERE boardid='".$boardid."' AND idx='".$fileinfo["list"][0]['idx']."' ");                //디스크에서 파일 삭제                @unlink($GLOBALS["_SITE"]["BOARD_DATA"] . "/".$boardid."/".$fileinfo["list"][0]['re_name']);            }        }    }    //파일삭제 코딩 종료    //파일처리    //if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["ID"]) {    inputBoardFiles($boardid, $idx, $_FILES, $thumwidth);    //}    if($rs){        return true;    }else{        return false;    }}function modifyAdminNote($boardid, $idx, $thumwidth){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql = "UPDATE ".$tblid." set 		adm_note01	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note01'])."',			adm_note02	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note02'])."',			adm_note03	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note03'])."',			adm_note04	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note04'])."',			adm_note05	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note05'])."',			adm_note06	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note06'])."',			adm_note07	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note07'])."',			adm_note08	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note08'])."',			adm_note09	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note09'])."',			adm_note10	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note10'])."',			adm_note11	='".mysqli_real_escape_string($GLOBALS['dblink'], $_POST['adm_note11'])."'		WHERE idx='".mysqli_real_escape_string($GLOBALS['dblink'], postNullCheck('idx'))."'";    //	echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_affected_rows($GLOBALS['dblink']);    if($rs){        return true;    }else{        return false;    }}//답글 등록하기function insertBoardArticleReply($boardid, $idx, $thumwidth){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //main 번호 가져오기    $q_main = mysqli_query("select main,sub,depth,email,usereplyemail,pass,uselock,no from ".$tblid." where idx = '".$idx."'", $GLOBALS['dblink']);    $row = mysqli_fetch_array($q_main);    $c_main =					$row[0];    $c_sub =						$row[1];    $c_depth =					$row[2];    $c_email =					$row[3];    $c_usereplyemail =		$row[4];    $c_pass =						$row[5];    $c_lock =						$row[6];    $c_no =						$row[7];    if($c_no=="0"){        jsMsg("공지글에는 답글을 달 수 없습니다.");        return false;    }    //잠긴글에 답글을 달 경우 원 사용자가 볼수 있게 비밀번호를 원 글의 비밀번호로 입력    if($c_lock =="Y"){        $pass = $c_pass;        $uselock = "Y";    }else{        $pass = mysql_escape_string($_POST[pass]);        $uselock = mysql_escape_string($_POST[uselock]=="Y"?"Y":"N");    }    $main = $c_main;    $sub = $c_sub + 1;    $depth = $c_depth + 1;    mysqli_query("UPDATE ".$tblid." set sub=sub+1 where no='1' and main='$main' and sub>'$c_sub'", $GLOBALS['dblink']);    if($_POST[wdate]) {        $sql_add = " wdate='".mysql_escape_string($_POST[wdate])."' ";    } else {        $sql_add = " wdate=now() ";    }    //게시판 테이블에 입력    $sql = "INSERT INTO ".$tblid." set 		no='1',		main='$main',		sub='$sub',		depth='$depth',		w_user='".$_POST['w_user_id']."',		r_user='".$_POST['r_user_id']."',		name='".mysql_escape_string($_POST['name'])."',		pass='".$pass."',		homepage='".mysql_escape_string($_POST['homepage'])."',		email='".mysql_escape_string($_POST['email'])."',		subject='".mysql_escape_string(str_replace("\"","'",$_POST['subject']))."',		contents='".mysql_escape_string($_POST['contents'])."',		usereplyemail='".mysql_escape_string($_POST['usereplyemail']=="Y"?"Y":"N")."',		usehtml='".mysql_escape_string($_POST['usehtml']=="Y"?"Y":"N")."',		category='".mysql_escape_string($_POST['category'])."',		uselock='".$uselock."',		hit='0',		etc_1='".mysql_escape_string($_POST['etc_1'])."',		etc_2='".mysql_escape_string($_POST['etc_2'])."',		etc_3='".mysql_escape_string($_POST['etc_3'])."',		etc_4='".mysql_escape_string($_POST['etc_4'])."',		etc_5='".mysql_escape_string($_POST['etc_5'])."',		ip='".$_SERVER['REMOTE_ADDR']."',		$sql_add	";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $insert_idx = mysqli_insert_id($GLOBALS['dblink']);    $total = mysqli_affected_rows($GLOBALS['dblink']);    //파일처리    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["ID"]) {        inputBoardFiles($boardid, $insert_idx, $_FILES, $thumwidth);    }    if($total > 0){        // 글 등록시 메일링여부        if ($c_usereplyemail=='Y'){            if($_POST['usehtml'] !='Y') $contents = nl2br($_POST['contents']);            mailing($GLOBALS["_SITE"]["NAME"],$GLOBALS["_SITE"]["EMAIL"],$c_email,$_POST[subject],$contents);        }        return true;    }else{        return false;    }}function cancelBoardArticle($boardid, $idx){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql = "UPDATE ".$tblid." set category='4', time='' 			WHERE idx='".$idx."'		";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_affected_rows($GLOBALS['dblink']);    if($total > 0){        return true;    }else{        return false;    }}//게시물 삭제하기function deleteBoardArticle($boardid, $idx, $pass){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $tbl_comment = $GLOBALS["_conf_tbl"]["comment"];    $tbl_board_product = $GLOBALS["_conf_tbl"]["board_product"];    //삭제권한 설정    $deletePerm = false;    //관리자는 그냥 통과    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["GRADE"]=="ROOT" || @in_array("board_manage",$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["AUTH"])){        $deletePerm = true;    }    //기존정보와 비밀번호를 비교 - 수정할때와 다른 함수를 씀 (파일 삭제 때문에)    $arrArticleInfo = getBoardArticleView($boardid, $category, $idx, "delete");    if($arrArticleInfo["list"][0]["pass"]==trim($pass) || password_verify(trim($pass), $arrArticleInfo["list"][0]["pass"])){        $deletePerm = true;    }    // 로그인 상태이고 로그인 아이디와 글 쓴 아이디가 같을 경우    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]==$arrArticleInfo["list"][0]["r_user"]){        $deletePerm = true;    }    if($deletePerm==true){        //게시판 테이블 지정        $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;        //게시판 테이블에서 삭제        $sql = "DELETE FROM ".$tblid." 			WHERE idx='".$idx."'		";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = mysqli_affected_rows($GLOBALS['dblink']);        //파일삭제 코딩 시작        for($i=0;$i<$arrArticleInfo["total_files"];$i++){            //디비에서 파일정보 삭제            mysqli_query("DELETE FROM ".$GLOBALS["_conf_tbl"]["board_files"]." WHERE boardid='".$boardid."' AND idx='".$arrArticleInfo["files"][$i]['idx']."' ", $GLOBALS['dblink']);            //디스크에서 파일 삭제            @unlink($GLOBALS["_SITE"]["BOARD_DATA"] . "/".$boardid."/".$arrArticleInfo["files"][$i]['re_name']);            //썸네일 삭제            if($arrArticleInfo["files"][$i]["type"]=="image/pjpeg" || $arrArticleInfo["files"][$i]["type"]=="image/x-png" || $arrArticleInfo["files"][$i]["type"]=="image/jpeg" || $arrArticleInfo["files"][$i]["type"]=="image/png" || $arrArticleInfo["files"][$i]["type"]=="image/gif"){                @unlink($GLOBALS["_SITE"]["BOARD_DATA"] . "/".$boardid."/t_".$arrArticleInfo["files"][$i]['re_name']);            }        }        //파일삭제 코딩 종료        //댓글 삭제        //mysqli_query("DELETE FROM ".$tbl_comment." WHERE boardid='".$boardid."' AND board_idx='".$idx."' ", $GLOBALS['dblink']);        //메인 event        if($boardid == "event1" || $boardid == "event2") {            mysqli_query("DELETE FROM tbl_board_tmp WHERE boardid='".$boardid."' AND b_idx='".$idx."' ", $GLOBALS['dblink']);        }        if($total > 0){            return true;        }else{            return false;        }    }else{        jsMsg("비밀번호가 일치하지 않습니다.");        return false;    }}//관리자 게시물 삭제시function deleteBoardAdmin($boardid, $idx){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $tbl_comment = $GLOBALS["_conf_tbl"]["comment"];    $tbl_board_product = $GLOBALS["_conf_tbl"]["board_product"];    //삭제권한 설정    $deletePerm = false;    //관리자는 그냥 통과    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["GRADE"]=="ROOT" || @in_array("board_manage",$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["AUTH"])){        $deletePerm = true;    }    $arrArticleInfo = getBoardArticleView($boardid, $category, $idx, "delete");    if($arrArticleInfo["list"][0]["w_user"]==trim($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"])){        $deletePerm = true;    }    if($deletePerm==true){        //게시판 테이블 지정        $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;        //게시판 테이블에서 삭제        $sql = "DELETE FROM ".$tblid." WHERE idx in (".$idx.")";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = mysqli_affected_rows($GLOBALS['dblink']);        if( $boardid=="ktoabiz" ){            $sql_ktoaresults = "";            $sql_ktoaresults = "DELETE FROM tbl_board_ktoaresults WHERE biz_idx in (".$idx.")";            $rs = mysqli_query($GLOBALS['dblink'], $sql_ktoaresults);        }        if($total > 0){            return true;        }else{            return false;        }    }else{        return false;    }}function bestBoardUp($sid, $idx){    $sql  = "SELECT etc_5 FROM tbl_board_after WHERE idx in (".$idx.") and etc_5 like '%". $sid ."%'";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    if($total_rs < 1){        $sql = "update tbl_board_after set etc_5 = CONCAT(etc_5, ',". $sid ."')  WHERE idx in (".$idx.")";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        return true;    }else{        return false;    }}//관리자 게시물 삭제시function updownBoardAdmin($boardid, $main, $updown){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    $sql .= "WHERE main = '$main' ";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    //echo $sql;    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        for($i=0; $i < $total_rs; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }    if($updown=="up"){        $sql  = "SELECT * FROM $tblid WHERE main > '$main' order by main asc limit 0,1 ";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total_rs = mysqli_num_rows($rs);        if($total_rs > 0){            $row = mysqli_fetch_assoc($rs);            $sql = "update ".$tblid." set main='$main' WHERE idx in (".$row["idx"].")";            //echo $sql;            $rs = mysqli_query($GLOBALS['dblink'], $sql);            $sql = "update ".$tblid." set main='".$row["main"]."' WHERE idx in (".$list['list'][0]["idx"].")";            $rs = mysqli_query($GLOBALS['dblink'], $sql);        }    }else{        $sql  = "SELECT * FROM $tblid WHERE main < '$main' order by main desc limit 0,1 ";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total_rs = mysqli_num_rows($rs);        if($total_rs > 0){            $row = mysqli_fetch_assoc($rs);            $sql = "update ".$tblid." set main='$main' WHERE idx in (".$row["idx"].")";            $rs = mysqli_query($GLOBALS['dblink'], $sql);            $sql = "update ".$tblid." set main='".$row["main"]."' WHERE idx in (".$list['list'][0]["idx"].")";            $rs = mysqli_query($GLOBALS['dblink'], $sql);        }    }    if($total_rs > 0){        return true;    }else{        return false;    }}//3년 지난 게시물 삭제하기function deleteBoardArticle3YearsAgo($boardid){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $tbl_comment = $GLOBALS["_conf_tbl"]["comment"];    $tbl_board_product = $GLOBALS["_conf_tbl"]["board_product"];    //삭제권한 설정    $deletePerm = true;    //관리자는 그냥 통과    //if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["GRADE"]=="ROOT" || @in_array("board_manage",$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["AUTH"])){    //$deletePerm = true;    //}    if($deletePerm==true){        //게시판 테이블 지정        $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;        $sqlWhere = " WHERE DATE_FORMAT(wdate,'%Y-%m-%d') < DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -3 YEAR),'%Y-%m-%d');";        //게시판 테이블에서 삭제        $sql = "DELETE FROM tbl_board_mindconsult".$sqlWhere;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = mysqli_affected_rows($GLOBALS['dblink']);        $sql = "DELETE FROM tbl_board_mindqna".$sqlWhere;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = $total+mysqli_affected_rows($GLOBALS['dblink']);        $sql = "DELETE FROM tbl_board_mindmtapp".$sqlWhere;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = $total+mysqli_affected_rows($GLOBALS['dblink']);        $sql = "DELETE FROM tbl_board_mindvisit".$sqlWhere;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = $total+mysqli_affected_rows($GLOBALS['dblink']);        $sql = "DELETE FROM tbl_board_mindvolunteer".$sqlWhere;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = $total+mysqli_affected_rows($GLOBALS['dblink']);        $sql = "DELETE FROM tbl_board_mindcheck".$sqlWhere;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = $total+mysqli_affected_rows($GLOBALS['dblink']);        if($total > 0){            return $total;        }else{            return "0";        }    }else{        jsMsg("권한이 없습니다.");        return false;    }}//게시물 가져오기 - idfunction getBoardArticleView($boardid, $category, $idx, $mode="read", $subQuery = ""){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $que_category = "";    //카테고리가 있을경우    if($category !=""){        $que_category = " and category in ('$category') ";    }    $que_category .= $subQuery;    //조회수 먼저 업데이트    if($mode=="read"){        $sql  = "UPDATE $tblid SET ";        $sql .= " hit = hit + 1 ";        $sql .= "WHERE idx = '".$idx."' $que_category ";        $rs = mysqli_query($GLOBALS['dblink'], $sql);    }    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    if($idx){        $sql .= "WHERE idx = '".$idx."' ".$que_category;    }else{        $sql .= "WHERE " .  $que_category;    }    $rs = mysqli_query($GLOBALS['dblink'], $sql);    //view 보기    //	echo "echo:"; print_r($sql); echo "<br>" ;    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        for($i=0; $i < $total_rs; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);            //html 사용여부 체크-> 읽기 페이지에서만            if($mode=="read" && $list['list'][$i]['usehtml']!='Y'){                $list['list'][$i]['contents'] = nl2br(htmlspecialchars($list['list'][$i]['contents']));            }            $b_sort = $list['list'][$i]['b_sort'];        }    }else{        $list['total'] = 0;    }    //이전글, 다음글은 읽기 모드일때만    if($mode=="read"){        //이전글 정보 가져오기        if($b_sort){	## 리스트 정렬사용시            $sql = "SELECT max(b_sort) FROM $tblid WHERE b_sort < '$b_sort' $que_category";        }else{            $sql = "SELECT max(idx) FROM $tblid WHERE idx < '$idx' $que_category";        }        //	echo $sql;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $prev = mysqli_result($rs,0,0);        if($prev > -1){            $list["prev"]["idx"] = $prev;            if($b_sort){	## 리스트 정렬사용시                $sql = "SELECT idx, name, subject, hit, wdate FROM $tblid WHERE b_sort = '$prev' $que_category";            }else{                $sql = "SELECT idx, name, subject, hit, wdate FROM $tblid WHERE idx = '$prev' $que_category ";            }            //	echo $sql;            $rs = mysqli_query($GLOBALS['dblink'], $sql);            $list["prev"] = mysqli_fetch_assoc($rs);        }else{            $list["prev"]["idx"] = 0;        }        //다음글 정보 가져오기        if($b_sort){	## 리스트 정렬사용시            $sql = "SELECT min(b_sort) FROM $tblid WHERE b_sort > '$b_sort' $que_category";        }else{            $sql = "SELECT min(idx) FROM $tblid WHERE idx > '$idx' $que_category";        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $next = mysqli_result($rs,0,0);        if($next > 0){            $list["next"]["idx"] = $next;            if($b_sort){	## 리스트 정렬사용시                $sql = "SELECT idx, name, subject, hit, wdate FROM $tblid WHERE b_sort = '$next' $que_category";            }else{                $sql = "SELECT idx, name, subject, hit, wdate FROM $tblid WHERE idx = '$next' $que_category ";            }            $rs = mysqli_query($GLOBALS['dblink'], $sql);            $list["next"] = mysqli_fetch_assoc($rs);        }else{            $list["next"]["idx"] = 0;        }    }    //파일정보 가져오기    $sql  = "SELECT * ";    $sql .= "FROM ".$GLOBALS["_conf_tbl"]["board_files"]." ";    $sql .= "WHERE boardid = '$boardid' ";    //$sql .= "AND b_idx = '$idx' AND LEFT(re_name,1) <> 'l' order by idx";    $sql .= "AND b_idx = '$idx' order by idx";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total_files'] = $total_rs;        for($i=0; $i < $total_rs; $i++){            $list['files'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total_files'] = 0;    }    return $list;}//게시물 가져오기 - nofunction getBoardViewNo($boardid, $category, $idx, $mode="read"){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $que_category = "";    //카테고리가 있을경우    if($category !=""){        $que_category = " and category in ($category) ";    }    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    $sql .= "WHERE main = '".$idx."' ".$que_category;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    //echo $sql;    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        for($i=0; $i < $total_rs; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);            //html 사용여부 체크-> 읽기 페이지에서만            if($mode=="read" && $list['list'][$i]['usehtml']!='Y'){                $list['list'][$i]['contents'] = nl2br(htmlspecialchars($list['list'][$i]['contents']));            }        }    }else{        $list['total'] = 0;    }    return $list;}//글잠금 해제function unlockBoardArticle($boardid, $idx, $pass){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql  = "SELECT * ";    $sql .= "FROM $tblid ";    $sql .= "WHERE idx = '$idx'";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $list['list'][0] = mysqli_fetch_assoc($rs);    if(password_verify($pass, $list["list"][0]["pass"]) || $pass == $list["list"][0]["pass"]){        return true;    }else{        return false;    }}//파일정보 가져오기function getArticleFileListInfo($boardid, $b_idx){    $sql  = "SELECT * ";    $sql .= "FROM " .$GLOBALS["_conf_tbl"]["board_files"]." ";    $sql .= "WHERE boardid = '$boardid' ";    $sql .= "AND b_idx = '$b_idx' ";//	echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        for($i=0; $i < $total_rs; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//파일정보 가져오기function getArticleFileInfo($boardid, $b_idx, $idx){    $sql  = "SELECT * ";    $sql .= "FROM " .$GLOBALS["_conf_tbl"]["board_files"]." ";    $sql .= "WHERE boardid = '$boardid' ";    $sql .= "AND b_idx = '$b_idx' ";    $sql .= "AND idx = '$idx' ";//	echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        for($i=0; $i < $total_rs; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//파일정보 가져오기function getArticleFileInfoImage($boardid, $idx){    $sql  = "SELECT * ";    $sql .= "FROM " .$GLOBALS["_conf_tbl"]["board_files"]." ";    $sql .= "WHERE boardid = '$boardid' ";    $sql .= "AND idx = '$idx' ";//	echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        for($i=0; $i < $total_rs; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//최근게시물 목록 가져오기function getBoardMember($boardid){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql = "SELECT distinct subject FROM $tblid order by subject desc";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_num_rows($rs);    if($total > 0){        $list['total'] = $total;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        for($i=0; $i < $total; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//게시판 파일처리## function inputBoardFiles($boardid, $idx, $_FILES, $thumwidth){function inputBoardFiles($boardid, $idx, $tmp, $thumwidth){    if($boardid=="accept"){	//        ########################################################### 멀티 파일 업로드 ########################################################### ST        $photo		= $_FILES['upfiles'];        $uploadDir	= $GLOBALS["_SITE"]["BOARD_DATA"] . "/".$boardid."/";        $fileName	= $photo['name'];        $tmpName	= $photo['tmp_name'];        $filesize	= $photo['size'];        $filetype	= $photo['type'];        //var_dump($photo);        //exit;        for($i=0; $i<count($fileName); $i++){            $memo			= $_POST["memo"];            $tmpFilename	= $fileName[$i];            $attach_ext		= explode(".",$tmpFilename);            $extension		= $attach_ext[sizeof($attach_ext)-1];            $extension		= strtolower($extension);            $fileRename		= $memo."_".md5(mktime()).$i.".".$extension;            if (is_uploaded_file($tmpName[$i])) {                move_uploaded_file($tmpName[$i], $uploadDir.$fileRename); // 디렉토리에 저장하기                $sql = "insert into ".$GLOBALS["_conf_tbl"]["board_files"]." set 					boardid='".$boardid."',/*게시판 아이디*/					b_idx='".$idx."',/* 글 번호 id*/					ori_name='".$fileName[$i]."',/*파일원본이름*/					re_name='".$fileRename."',/*md5로 변환된 파일이름*/					type='".$filetype[$i]."',/*파일타입*/					ext ='".$extension."',/*파일확장자*/					size='".$filesize[$i]."',/*첨부파일 용량*/					wdate=now()				";                $rsf = mysqli_query($GLOBALS['dblink'], $sql);            }        }        ########################################################### 멀티 파일 업로드 ########################################################### ED    }else{        for($i=0;$i<count($_FILES['upfiles']['error']);$i++){            if ($_FILES['upfiles']['error'][$i] == 0){                //확장자 검사후 파일이름 생성                if(isset($_POST['memo_name'][$i])){                    $memo = $_POST['memo_name'][$i];                }else{                    $memo = "";                }                $filename = $_FILES['upfiles']['name'][$i];                $attach_ext = explode(".",$filename);                $extension = $attach_ext[sizeof($attach_ext)-1];                $extension = strtolower($extension);                $filerename = $memo."_".md5(mktime()) . $i . "." . $extension;                $filesize = $_FILES['upfiles']['size'][$i];                $filetype = $_FILES['upfiles']['type'][$i];                // 파일 확장자 검사                if(!strcmp($extension,"htm") ||!strcmp($extension,"html") ||!strcmp($extension,"phtml") ||!strcmp($extension,"php") ||!strcmp($extension,"php3") ||!strcmp($extension,"php4") ||!strcmp($extension,"inc") ||!strcmp($extension,"pl") ||!strcmp($extension,"cgi")){                    jsMsg("not allowed file extension");                    jsHistory("-1");                }                if (is_uploaded_file($_FILES['upfiles']['tmp_name'][$i])) {                    move_uploaded_file ($_FILES['upfiles']['tmp_name'][$i], $GLOBALS["_SITE"]["BOARD_DATA"] . "/".$boardid."/".$filerename);                    //썸네일 만들기                    if($filetype=="image/pjpeg" || $filetype=="image/x-png" || $filetype=="image/jpeg" || $filetype=="image/png" || $filetype=="image/gif"){                        @MakeThum($GLOBALS["_SITE"]["BOARD_DATA"] . "/".$boardid."/".$filerename, $GLOBALS["_SITE"]["BOARD_DATA"] . "/".$boardid."/t_".$filerename, $thumwidth);                    }                }                $sql = "insert into ".$GLOBALS["_conf_tbl"]["board_files"]." set 					boardid='".$boardid."',/*게시판 아이디*/					b_idx='".$idx."',/* 글 번호 id*/					ori_name='".$filename."',/*파일원본이름*/					re_name='".$filerename."',/*md5로 변환된 파일이름*/					type='".$filetype."',/*파일타입*/					ext ='".$extension."',/*파일확장자*/					size='".$filesize."',/*첨부파일 용량*/					wdate=now()				";                $rsf = mysqli_query($GLOBALS['dblink'], $sql);            }        }    }}//댓글 목록 가져오기function getCommentList($boardid, $board_idx, $scale, $offset2=0, $page=""){    // 테이블 지정    $tbl = $GLOBALS["_conf_tbl"]["comment"];    $sql = "SELECT * FROM $tbl WHERE 1=1 ";    if($boardid !=""){        $sql .= " AND boardid='$boardid' ";    }    if($board_idx !=""){        $sql .= " AND board_idx='$board_idx' ";    }    if($page == "admin") {        $sql .= " order by idx desc ";    } else {        $sql .= " order by idx desc ";    }    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    //echo $sql;    if($total_rs > 0){        $list['total'] = $total_rs;        // 페이지 네비게이션 오프셋 지정.        if(!$offset2){            $offset2=0;        }else{            $offset2=$offset2;        }        // offset 이 전체 게시물수보다 작을때 offset 을 전체게시물 - 페이지당 보여줄 글 수로 offset 설정        if($total_rs<=$offset2){            $offset2 = $total_rs - $scale;        }        //scale 0 으로 지정시에는 전체 가져옴        if($scale > 0){            $sql .= " limit $offset2, $scale ";        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        // offset 을 이용한 limit 가 적용된 갯수        $total = mysqli_num_rows($rs);        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//댓글 등록하기function insertComment($boardid, $board_idx){    // 테이블 지정    $tbl = $GLOBALS["_conf_tbl"]["comment"];    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["ID"]) {        $user_id = $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["ID"];        $user_name = $GLOBALS["_SITE"]["NAME"];    } else {        $user_id = $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"];        $user_name = $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["NAME"];    }    $user_id = $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"];    $user_name = $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["NAME"];    //$arrInfo = getBoardArticleView($boardid, "", $board_idx, "comment");    $grpno = 1;    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["ID"] || $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]) {        //댓글 테이블에 입력        $sql = "INSERT INTO ".$tbl." set 			boardid='$boardid',			board_idx='$board_idx',			prino='".$grpno."',			user_id='".$user_id."',			user_name='".$user_name."',			comment='".strip_tags($_POST['comment'])."',			ip='".$_SERVER['REMOTE_ADDR']."',			wdate=now()		";        //echo $sql;        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $insert_idx = mysqli_insert_id($GLOBALS['dblink']);    }    $total = mysqli_affected_rows($GLOBALS['dblink']);    if($total > 0){        return true;    }else{        return false;    }}//댓글 수정하기function updateComment($boardid, $board_idx, $idx){    // 테이블 지정    $tbl = $GLOBALS["_conf_tbl"]["comment"];    //댓글 테이블에 입력    $sql = "UPDATE ".$tbl." set 		comment='".mysql_escape_string($_POST[comment])."',		ip='".$_SERVER[REMOTE_ADDR]."'		Where boardid='$boardid' and board_idx='$board_idx' and idx='".$idx."'	";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_affected_rows($GLOBALS['dblink']);    if($total > 0){        return true;    }else{        return false;    }}//댓글에 댓글 등록하기function replyComment($boardid, $board_idx, $idx){    // 테이블 지정    $tbl = $GLOBALS["_conf_tbl"]["comment"];    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["ID"]) {        $user_id = $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["ID"];        $user_name = $GLOBALS["_SITE"]["NAME"];    } else {        $user_id = $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"];        $user_name = $_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["NICK"]?$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["NICK"]:$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["NAME"];    }    $sql = "select prino,depno from ".$tbl." where idx='$idx'";    $result = mysqli_query($sql) or error(mysqli_error());    $row = mysqli_fetch_array($result);    $prino = $row[prino];    $depno = ++$row[depno];    $sql = "update ".$tbl." set prino = prino+1 where boardid='$boardid' and board_idx='$board_idx' and prino >= '$prino'";    $result = mysqli_query($GLOBALS['dblink'], $sql);    //댓글 테이블에 입력    $sql = "INSERT INTO ".$tbl." set 		boardid='$boardid',		board_idx='$board_idx',		prino='".$prino."',		depno='".$depno."',		user_id='".$user_id."',		user_name='".$user_name."',		comment='".mysql_escape_string($_POST[comment])."',		ip='".$_SERVER[REMOTE_ADDR]."',		wdate=now()	";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_affected_rows($GLOBALS['dblink']);    if($total > 0){        return true;    }else{        return false;    }}//댓글 가져오기 - idfunction getCommentInfo($idx){    // 테이블 지정    $tbl = $GLOBALS["_conf_tbl"]["comment"];    $sql  = "SELECT * ";    $sql .= "FROM $tbl ";    $sql .= "WHERE idx = '$idx' ";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    //echo $sql;    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        for($i=0; $i < $total_rs; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//댓글 삭제하기function deleteComment($idx){    // 테이블 지정    $tbl = $GLOBALS["_conf_tbl"]["comment"];    //삭제권한 설정    $deletePerm = false;    //관리자는 그냥 통과    if($_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["GRADE"]=="ROOT" || @in_array("board_manage",$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["ADMIN"]["AUTH"])){        $deletePerm = true;    }    //기존정보    $arrArticleInfo = getCommentInfo($idx);    if($arrArticleInfo["list"][0]["user_id"]==$_SESSION[$GLOBALS["_SITE"]["DOMAIN"]]["MEMBER"]["ID"]){        $deletePerm = true;    }    if($deletePerm==true){        //댓글 테이블에서 삭제        $sql = "DELETE FROM ".$tbl." 			WHERE idx='$idx'		";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $total = mysqli_affected_rows($GLOBALS['dblink']);        if($total > 0){            return true;        }else{            return false;        }    }else{        // jsMsg("삭제할 권한이 없습니다.");        return false;    }}//==================================================// 첫화면 인텍스 메인화면에 리스트와 이미지 부르기// 200900604//===================================================function getBoardLastNImage($boardid, $limit,$category=""){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //카테고리가 있을경우    if($category !=""){        $que_category = " and A.category='$category' ";    }    //목록    $sql  = "SELECT A.*, B.idx AS f_idx, B.boardid, B.b_idx, B.ori_name, B.re_name, B.type, B.size ";    $sql .= "FROM $tblid A LEFT JOIN ".$GLOBALS["_conf_tbl"]["board_files"]." B ON B.boardid='$boardid' AND A.idx=B.b_idx AND B.ext IN('jpg','gif','png')";    $sql .= "WHERE A.no='1' $que_where $que_category group by A.idx DESC LIMIT $limit";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    // offset 을 이용한 limit 가 적용된 갯수    $total = mysqli_num_rows($rs);    $list['list']['total'] = $total;    // 페이지 네비게이션 오프셋 지정.    if($total > 0){        $list['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    }else{        $list['total'] = 0;    }    return $list;}//==============================================// 게시물 첨부파일,메모카운트// 20090507// 첨부파일조인후 메모카운트는 배열에 추가저장// 피노갤러리에서 가져옴//==============================================function getBoardListBaseNFileNMemoCnt($boardid, $category, $sw="", $sk="", $scale, $offset=0){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    // 추가부분    // 코멘트 테이블    $tbl_comment = $GLOBALS["_conf_tbl"]["comment"];    //카테고리가 있을경우    if($category !=""){        $que_category = " and A.category='$category' ";    }    //검색키워드가 있을경우    if($sk !=""){        switch($sw){            case("n") :                $que_where = "and A.name like '%$sk%'";                break;            case("s") :                $que_where = "and A.subject like '%$sk%'";                break;            case("c") :                $que_where = "and A.contents like '%$sk%'";                break;            case("ltdNm") :                $que_where = "and A.etc_7 like '%$sk%'";                break;            case("a") :            default :                $que_where = "and (A.name like '%$sk%' or A.subject like '%$sk%' or A.contents like '%$sk%')";        }        // 검색시 영역을 분할하여 검색=> 속도향상용        $sql = "select count(A.idx) as cnt from $tblid A";        $rs = mysqli_query($GLOBALS['dblink'], $sql);        $row = mysqli_fetch_assoc($rs);        $q_total = $row[cnt];        $q_start = $q_total - 10000; // 최근 10000건만 검색        if($q_total>10000){            $q_limit = " A.idx between " . $q_start . " and " . $q_total . " ";        }        // 검색시 영역을 분할하여 검색=> 속도향상용    }    //카운트    $sql = "select count(A.idx) from $tblid A WHERE A.no='1' $q_limit $que_where $que_category ";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $row = mysqli_fetch_row($rs);    $total_rs = $row[0];    //목록    $sql  = "SELECT A.*, B.idx AS f_idx, B.boardid, B.b_idx, B.ori_name, B.re_name, B.type, B.size ";    $sql .= "FROM $tblid A LEFT JOIN ".$GLOBALS["_conf_tbl"]["board_files"]." B ON B.boardid='$boardid' AND A.idx=B.b_idx ";    $sql .= "WHERE A.no='1' $q_limit $que_where $que_category group by A.idx";    if($total_rs > 0){        $list['total'] = $total_rs;        // 페이지 네비게이션 오프셋 지정.        if(!$offset){            $offset=0;        }else{            $offset=$offset;        }        // offset 이 전체 게시물수보다 작을때 offset 을 전체게시물 - 페이지당 보여줄 글 수로 offset 설정        if($total_rs<=$offset){            $offset = $total_rs - $scale;        }        //scale 0 으로 지정시에는 전체 가져옴        if($scale > 0){            $sql .= " order by A.main limit $offset,$scale ";        }else{            $sql .= " order by A.main ";        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        // offset 을 이용한 limit 가 적용된 갯수        $total = mysqli_num_rows($rs);        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['list'][$i] = mysqli_fetch_assoc($rs);            // 댓글 카운트 추가 부분            $m_cnt_row = mysqli_fetch_row(mysqli_query("select count(idx) from $tbl_comment WHERE boardid='$boardid' AND board_idx='".$list['list'][$i][idx]."' "));            $list['list'][$i][cmt_count] = $m_cnt_row[0];        }    }else{        $list['total'] = 0;    }    return $list;}//easyUi json Listfunction getJsonList($boardid, $scale, $offset=0, $orderby="", $wheresql=""){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    if($orderby){        $ordersql = $orderby;    }else{        $ordersql = "order by main desc" ;    }    $sql = "SELECT * FROM $tblid $wheresql $ordersql";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    if($total_rs > 0){        $list['total'] = $total_rs;        // 페이지 네비게이션 오프셋 지정.        if(!$offset){            $offset=0;        }else{            $offset=$offset;        }        // offset 이 전체 게시물수보다 작을때 offset 을 전체게시물 - 페이지당 보여줄 글 수로 offset 설정        if($total_rs<=$offset){            $offset = $total_rs - $scale;        }        //scale 0 으로 지정시에는 전체 가져옴        if($scale > 0){            $sql .= " limit $offset,$scale ";        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        // offset 을 이용한 limit 가 적용된 갯수        $total = mysqli_num_rows($rs);//			echo $sql;        //$list['row']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['rows'][$i] = mysqli_fetch_assoc($rs);            $list['rows'][$i]["rownum"] = $total_rs-$i-$offset;        }    }else{        $list['total'] = 0;    }    return $list;}//easyUi json Listfunction getJsonListFile($boardid, $scale, $offset=0, $orderby="", $wheresql=""){    //게시판 테이블 지정    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    if($orderby){        $ordersql = $orderby;    }else{        $ordersql = "order by A.idx desc" ;    }    $sql = "SELECT * FROM $tblid AS A $wheresql $ordersql";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total_rs = mysqli_num_rows($rs);    $sub_query = $GLOBALS["_conf_tbl"]["board_files"];    $sql  = " SELECT A.*, B.idx AS f_idx, B.boardid, B.b_idx, B.ori_name, B.re_name, B.type, B.size ";    $sql .= " FROM $tblid A LEFT JOIN ".$sub_query." B ON B.boardid='$boardid' AND A.idx=B.b_idx ";    $sql .= " $wheresql group by A.idx";    if($total_rs > 0){        $list['total'] = $total_rs;        // 페이지 네비게이션 오프셋 지정.        if(!$offset){            $offset=0;        }else{            $offset=$offset;        }        // offset 이 전체 게시물수보다 작을때 offset 을 전체게시물 - 페이지당 보여줄 글 수로 offset 설정        if($total_rs<=$offset){            $offset = $total_rs - $scale;        }        //scale 0 으로 지정시에는 전체 가져옴        if($scale > 0){            $sql .= " order by A.no, A.main, A.sub limit $offset,$scale ";        }else{            $sql .= " order by A.no, A.main, A.sub ";        }        $rs = mysqli_query($GLOBALS['dblink'], $sql);        // offset 을 이용한 limit 가 적용된 갯수        $total = mysqli_num_rows($rs);//			echo $sql;        //$list['row']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for($i=0; $i < $total; $i++){            $list['rows'][$i] = mysqli_fetch_assoc($rs);            $list['rows'][$i]["rownum"] = $total_rs-$i-$offset;        }    }else{        $list['total'] = 0;    }    return $list;}########################################################### 이벤트// 등록하기function insertTarot($boardid, $sid, $tca, $tcaval){    // 테이블 지정    $tbl = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql = "	INSERT INTO ".$tbl." set 		subject='".$sid."',		".$tca."='".$tcaval."',		ip='".$_SERVER['REMOTE_ADDR']."',		wdate=now()	";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $insert_idx = mysqli_insert_id($GLOBALS['dblink']);    $total = mysqli_affected_rows($GLOBALS['dblink']);    if($total > 0){        return true;    }else{        return false;    }}//댓글 수정하기function updateTarot($boardid, $sid, $tca, $tcaval){    // 테이블 지정    $tbl = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    //댓글 테이블에 입력    $sql = "UPDATE ".$tbl." set 		".$tca."='".$tcaval."',		ip='".$_SERVER['REMOTE_ADDR']."'		Where subject='".$sid."'	";    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_affected_rows($GLOBALS['dblink']);    if($total > 0){        return true;    }else{        return false;    }}############################################################################# 2024-07-09 권순표 제작 ###################################################################################// 접수번호로 결제 정보 불러오기function getBoardViewNRUser($boardid, $r_user){    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql_add = "";    $sql_add .= " and r_user = '$r_user' ";    $sql = " select * from ".$tblid." where 1=1 ".$sql_add;    //echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_num_rows($rs);    $list['total'] = $total;    if ($total > 0) {        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for ($i = 0; $i < $total; $i++) {            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    } else {        $list['total'] = 0;    }    return $list;}// 주문번호로 결제 정보 불러오기function getBoardViewNoid($boardid, $oid, $user_code){    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql_add = "";    //$sql_add .= " and fax = '$is_user' "; // 회원/비회원 구분    $sql_add .= " and w_user = '$user_code' ";    $sql_add .= " and order_no = '$oid' ";    $sql = " select * from ".$tblid." where 1=1 ".$sql_add;    //echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_num_rows($rs);    $list['total'] = $total;    if ($total > 0) {        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for ($i = 0; $i < $total; $i++) {            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    } else {        $list['total'] = 0;    }    return $list;}// idx와 id로 해당 게시물 찾기function getBoardViewNusercode($boardid, $idx, $user_code){    $tblid = $GLOBALS["_SITE"]["BOARD_PREWORD"] . $boardid;    $sql_add = "";    //$sql_add .= " and fax = '$is_user' "; // 회원/비회원 구분    $sql_add .= " and w_user = '$user_code' ";    $sql_add .= " and idx = '$idx' ";    $sql = " select * from ".$tblid." where 1=1 ".$sql_add;    //echo $sql;    $rs = mysqli_query($GLOBALS['dblink'], $sql);    $total = mysqli_num_rows($rs);    $list['total'] = $total;    if ($total > 0) {        $list['list']['total'] = $total;        // 페이지 네비게이션 오프셋 지정.        for ($i = 0; $i < $total; $i++) {            $list['list'][$i] = mysqli_fetch_assoc($rs);        }    } else {        $list['total'] = 0;    }    return $list;}function getEduCopy($estNum) {    // Fetch the original education record    $query = "SELECT * FROM tbl_board_edu WHERE idx='".$estNum."' ";    $arrEduList = getFreeQueryR($query);    for ($i = 0; $i < $arrEduList["total"]; $i++) {        // Get the minimum main value        $q_main = mysqli_query($GLOBALS['dblink'], "SELECT min(main) FROM tbl_board_edu");        $c_main = @mysqli_result($q_main, 0, 0);        if (!$c_main) {            $main = '99999999';        } else {            $main = $c_main - 1;        }        // Insert the new education record        $sql = "INSERT INTO tbl_board_edu SET            no='1',            main='$main',            sub='0',            depth='0',            w_user='" . $userNumber . "',            r_user='" . $arrEduList['list'][$i]['r_user'] . "',            name='" . $arrEduList['list'][$i]['name'] . "',            pass='',            homepage='" . $arrEduList['list'][$i]['homepage'] . "',            tel='" . $arrEduList['list'][$i]['tel'] . "',            fax='" . $arrEduList['list'][$i]['fax'] . "',            email='" . $arrEduList['list'][$i]['email'] . "',            subject='" . $arrEduList['list'][$i]['subject'] . "',            contents='" . $arrEduList['list'][$i]['contents'] . "',            usereplyemail='N',            usehtml='Y',            category='" . $arrEduList['list'][$i]['category'] . "',            uselock='N',            hit='0',            b_sort='0',            etc_1='" . $eduNumber . "',            etc_2='" . $arrEduList['list'][$i]['etc_2'] . "',            etc_3='" . $arrEduList['list'][$i]['etc_3'] . "',            etc_4='" . $arrEduList['list'][$i]['etc_4'] . "',            etc_5='" . $arrEduList['list'][$i]['etc_5'] . "',            ip='" . $_SERVER['REMOTE_ADDR'] . "',            schedule_date='" . $arrEduList['list'][$i]['schedule_date'] . "',            wdate=now(),                       remarks='" . $arrEduList['list'][$i]['remarks'] . "'";        $rs = mysqli_query($GLOBALS['dblink'], $sql);    }}