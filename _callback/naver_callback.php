<!doctype html><html lang="ko"><head>	<meta charset="UTF-8" /></head><body><?phpinclude $_SERVER["DOCUMENT_ROOT"] . "/include/headHtml.php";include_once $_SERVER["DOCUMENT_ROOT"] . "/module/member/member.lib.php";// 네이버 로그인 콜백 예제$client_id = "piN0UzyFFMT6EkKmIePX";$client_secret = "_86Oad7b6j";$code = $_GET["code"];$state = $_GET["state"];$redirectURI = urlencode("http://".$_SERVER['SERVER_NAME']."/_callback/naver_callback.php");$url = "https://nid.naver.com/oauth2.0/token?grant_type=authorization_code&client_id=".$client_id."&client_secret=".$client_secret."&redirect_uri=".$redirectURI."&code=".$code."&state=".$state;$is_post = false;$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_POST, $is_post);curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);$headers = array();$response = curl_exec ($ch);$status_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);// echo "status_code:".$status_code."";curl_close ($ch);if($status_code == 200) {	//echo $response;	$_SESSION['naver_access_token'] = json_decode($response, TRUE);} else {	echo "Error 내용:".$response;}?><?php$token = $_SESSION['naver_access_token']['access_token'];$header = "Bearer ".$token; // Bearer 다음에 공백 추가$url = "https://openapi.naver.com/v1/nid/me";$is_post = false;$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_POST, $is_post);curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);$headers = array();$headers[] = "Authorization: ".$header;curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);$response = curl_exec ($ch);$status_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);// echo "status_code:".$status_code."<br>";curl_close ($ch);if($status_code == 200) {	//echo $response;	$resJson = json_decode($response, TRUE);	$email = $resJson['response']['email'];	$name = $resJson['response']['name'];	$id = $resJson['response']['id'];	$mobile = $resJson['response']['mobile'];	//echo $email . $name . $id;	$dblink = SetConn($_conf_db["main_db"]);	$RS = loginMemberUnite("naver_".$id, $id."@pwd", "naver");	SetDisConn($dblink);	if($RS["list"][0]["join_type"]=="naver"){	// 로그인 아이디 존재 (유)?><form action='/module/member/member_evn.php' method='post' name='loginForm'><input type="hidden" name="evnMode" value="login"><input type="hidden" name="rt_url" value="<?=$_SESSION['CB_RT_URL']?>"><input type="hidden" id="id" name="id" value="naver_<?=$id?>" /><input type="hidden" id="pw" name="pw" value="<?=$id?>@pwd" /></form><script type="text/javascript"><!--document.loginForm.submit();//--></script><?	}else if($RS["list"][0]["join_type"]=="unite"){	// 통합회원?><form action='/module/member/member_evn.php' method='post' name='loginForm'><input type="hidden" name="evnMode" value="login"><input type="hidden" name="rt_url" value="<?=$_SESSION['c']?>"><input type="hidden" id="id" name="id" value="naver_<?=$id?>" /><input type="hidden" id="pw" name="pw" value="<?=$id?>@pwd" /><input type="hidden" name="uniteUser" value="naver"></form><script type="text/javascript"><!--document.loginForm.submit();//--></script><?	}else{	$_SESSION['social']['type']  = "naver";	$_SESSION['social']['email'] = $email;	$_SESSION['social']['name'] = $name;	$_SESSION['social']['id'] = $id;	$_SESSION['social']['mobile']= $mobile;	// 여기서 회원검색후 네이버가입회원이면 로그인 but 네이버아이디로 회원가입페이지로 이동시킨다	// 이메일계정이 존재하면 이미 가입된 계정 표시후 롤백?><script type="text/javascript"><!--//var con_txt = confirm("네이버 로그인 연동중입니다. 회원가입페이지로 이동합니다.");//if(con_txt==true)	{	location.href="/member/join_social.php";//}else{//	location.href="/";//}//--></script><?	}} else {	jsGo("/member/join_social.php","","");//	echo "Error 내용:".$response;}?></body></html>