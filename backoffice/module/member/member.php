<?PHPinclude $_SERVER['DOCUMENT_ROOT'] . "/backoffice/pub/inc/admin_top.php";include $_SERVER['DOCUMENT_ROOT'] . "/backoffice/module/admin/menu.php";include_once $_SERVER ['DOCUMENT_ROOT'] . "/module/member/member.lib.php";include_once $_SERVER ['DOCUMENT_ROOT'] . "/module/member/account.lib.php";include_once $_SERVER ['DOCUMENT_ROOT'] . "/module/board/board.lib.php";if (! in_array ( "member_manage", $_SESSION [$_SITE ["DOMAIN"]] ["ADMIN"] ["AUTH"] ) && $_SESSION [$_SITE ["DOMAIN"]] ["ADMIN"] ["GRADE"] != "ROOT") :	jsMsg ( "권한이 없습니다." );	jsHistory ( "-1" );endif;if ($_GET['page_size']) {	$scale = $_GET['page_size'];} elseif ($_GET['page_size'] === '0') {	$scale = 0;} else {	$scale = 20;}if (isset($_GET['mstatus']) && $_GET['mstatus'] !== '') {	$mstatus = $_GET['mstatus'];} else {	$mstatus = 1; // 기본값 설정}// DB연결$dblink = SetConn ( $_conf_db ["main_db"] );$arrList = getMemberList( mysqli_real_escape_string ( $GLOBALS ['dblink'], $_REQUEST ['jb'] ),  mysqli_real_escape_string ( $GLOBALS ['dblink'], $_REQUEST ['sw'] ), mysqli_real_escape_string ( $GLOBALS ['dblink'], $_REQUEST ['sk'] ), $scale, $_REQUEST['offset'],	"and mstatus=" . mysqli_real_escape_string($GLOBALS['dblink'], $mstatus),	" order by memberid desc");// _DEBUG($arrList);$chDate = date('Y-m-d H:i:s',strtotime(date("Y-m-d")."-30 day"));   // 한달// DB해제//SetDisConn ( $dblink );?><style>    .bdr_btm .btns .btn_del {width: 100px;}</style><script>// 선택 삭제시 singleSelect=true 값 변경 falsefunction getSelectionMemeber(selectedValue) {    var ss = "0";    var rows = $('input:checkbox[name=chk_list]:checked');    for (var i = 0; i < rows.length; i++) {        var row = rows[i];        ss += "," + row.value;    }    if (rows.length > 0) {        memberLevel(ss, selectedValue);    } else {        alert('선택된 항목이 없습니다.');    }}function boardDel(val){	//location.href="/backoffice/module/member/ajax_member_del.php?g_idx="+val;	//return;	//alert(val);	//return;	if(confirm("탈퇴 처리 하시겠습니까?")) {		$.post("/backoffice/module/member/ajax_member_del.php", {g_idx: val },		function(data){					//alert(data);			location.reload();		});	}}function memberLevel(idx, lval){	if(confirm("수정 하시겠습니까?")) {        $.post("/backoffice/module/member/ajax_member_level.php", {                g_idx: idx,                levelval: lval,                child_violation: $('#child_violation').val(),                child_category: lval,                child_violation_wdate: $('#child_violation_wdate').text(),                child_violation_start_date: $('#child_violation_start_date').val(),                child_violation_end_date: $('#child_violation_end_date').val()            },		function(data){					//alert(data);			location.reload();		});	}}function delMember(id){	var cfm;	cfm =false;	cfm = confirm(id + " 이 회원을 탈퇴처리 하시겠습니까?\n\n탈퇴처리시 복구 불가능합니다.");	if(cfm==true){		document.frmContentsHidden.user_id.value = id;		document.frmContentsHidden.submit();	}} // 선택 삭제시 singleSelect=true 값 변경 false function getSelections(action) {     var ss = "0";     var rows = $('input:checkbox[name=chk_list]:checked');     // Collect selected IDs     for(var i=0; i<rows.length; i++){         var row = rows[i];         ss += "," + row.value;     }     if(rows.length > 0){         switch(action) {             case 'delete':                 boardDel(ss);                 break;             case 'sms':                 sendSMS(rows);                 break;             case 'email':                 sendEmail(rows);                 break;             default:                 alert('올바른 작업을 선택해주세요.');                 break;         }     } else {         alert('선택된 항목이 없습니다.');     } } // SMS sending functionfunction sendSMS(selectedRows) {    var smsTemplateId = $('select[name=sms_options]').val();    if (!smsTemplateId) {        alert('문자발송 리스트에서 발송할 내용을 선택해주세요.');        return;    }    var phones = [];    var idx = smsTemplateId;    // 선택된 행에서 전화번호 수집    $(selectedRows).each(function() {        var row = $(this).closest('tr');        var phone = row.find('td:eq(6)').text().trim(); // 연락처 컬럼        if (phone) {            phones.push(phone);        }    });    if (confirm(phones.length + '개의 번호로 문자를 발송하시겠습니까?')) {        $.ajax({            url: '/module/board/ajax_board_send_sms.php',            type: 'POST',            data: {                phones: phones.join(','),                idx: idx,                etc_3: '<?=$smsMailId?>'            },            success: function(response) {                if (response === "true") {                    alert('문자가 발송되었습니다.');                } else {                    alert('문자 발송 중 오류가 발생했습니다: ' + response.message);                }            },            error: function() {                alert('문자 발송 요청 중 오류가 발생했습니다.');            }        });    }} // Email sending function function sendEmail(selectedRows) {     var emailTemplateId = $('select[name=email_options]').val();     if (!emailTemplateId) {         alert('이메일발송 리스트에서 발송할 내용을 선택해주세요.');         return;     }     var emails = [];     var idx = emailTemplateId;     // Collect email addresses from selected rows     $(selectedRows).each(function() {         var row = $(this).closest('tr');         var email = row.data('email'); // Get email address from data attribute         if (email) {             emails.push(email);         }     });     if (confirm(emails.length + '개의 이메일로 발송하시겠습니까?')) {         $.ajax({             url: '/module/board/ajax_board_send_mail.php',             type: 'POST',             data: {                 emails: emails.join(','),                 idx: idx,                 etc_3 : '<?=$smsMailId?>'             },             success: function(response) {                 if (response === "true") {                     alert('이메일이 발송되었습니다.');                 } else {                     //alert(response);                     alert('이메일 발송 중 오류가 발생했습니다: ' + response);                 }             },             error: function() {                 alert('이메일 발송 요청 중 오류가 발생했습니다.');             }         });     } }</script><div class="container">	<div class="title">회원 리스트</div>	<form name="frmSort" method="get" action="member.php">	<div class="inbox top_search">		<!--<dl>			<dt>회원정렬</dt>			<dd>				<select name="orderby" id="" style="width:120px;" onchange="document.frmSort.submit()" >					<option value="">회원가입날짜</option>					<option value="sum_amount" <?=$_GET['orderby']=="sum_amount"?"selected":""?>>총 구매금액 순</option>					<option value="cnt_amount" <?=$_GET['orderby']=="cnt_amount"?"selected":""?>>총 구매 건수</option>					<option value="cnt_cag"  <?=$_GET['orderby']=="cnt_cag"?"selected":""?>>교환 완료</option>					<option value="cnt_cet"  <?=$_GET['orderby']=="cnt_cet"?"selected":""?>>환불 완료</option>				</select>			</dd>		</dl>-->		<!---->        <dl>            <dt>회원상태</dt>            <dd>                <select name="user_level">                    <option value="">전체</option>                    <?for ($i=0;$i<$arrLevel['total'];$i++) {?>                        <option value="<?=$arrLevel['list'][$i]['level_no']?>" <?=$arrLevel['list'][$i]['level_no']==$_GET["user_level"]?" selected":""?>><?=$arrLevel['list'][$i]['level_name']?></option>                    <?}?>                </select>            </dd>        </dl>		<dl>			<dt>가입구분</dt>			<dd>				<select name="join_type" id="" style="width:100px;">					<option value="">전체</option>					<option value="homepage" <?=$_GET['join_type']=="homepage"?"selected":""?>>일반</option>					<option value="naver"  <?=$_GET['join_type']=="naver"?"selected":""?>>네이버</option>					<option value="kakao"  <?=$_GET['join_type']=="kakao"?"selected":""?>>카카오</option>					<!-- <option value="google"  <?=$_GET['join_type']=="google"?"selected":""?>>구글</option> -->				</select>			</dd>		</dl>		<dl>			<dt>메일 수신동의</dt>			<dd>				<select name="email_accept" id="email_accept" style="width:100px;">					<option value="">전체</option>					<option value="Y" <?=$_GET['email_accept']=="Y"?"selected":""?>>Y</option>					<option value="N"  <?=$_GET['email_accept']=="N"?"selected":""?>>N</option>				</select>			</dd>		</dl>		<dl>			<dt>SMS 수신동의</dt>			<dd>				<select name="sms_accept" id="sms_accept" style="width:100px;">					<option value="">전체</option>					<option value="Y" <?=$_GET['sms_accept']=="Y"?"selected":""?>>Y</option>					<option value="N"  <?=$_GET['sms_accept']=="N"?"selected":""?>>N</option>				</select>			</dd>		</dl>		<dl class="w2">			<dt>가입일</dt>			<dd><input type="text" class="datepicker" name="s_date" value="<?=$_REQUEST['s_date']?>"  /><em>~</em><input type="text" class="datepicker" name="e_date" value="<?=$_REQUEST['e_date']?>" /></dd>		</dl>        <dl class="w2">            <dt>최종 로그인</dt>            <dd><input type="text" class="datepicker" name="login_last" value="<?=$_REQUEST['login_last']?>"  /></dd>        </dl>		<dl class="search_wrap">			<dt>검색어</dt>			<dd>				<select name="sw" style="width:100px;">					<option value="all" <?=$_REQUEST['sw']=="all"?" selected":""?>>전체</option>					<option value="namek" <?=$_REQUEST['sw']=="namek"?" selected":""?>>이름</option>					<option value="loginid" <?=$_REQUEST['sw']=="loginid"?" selected":""?>>아이디</option>                    <option value="memberid" <?=$_REQUEST['sw']=="memberid"?" selected":""?>>mid</option>				</select>				<input type="text" name="sk" value="<?=$_GET['sk']?>" onkeypress="if( event.keyCode == 13 ){document.frmSort.submit();}"/>				<button type="button" class="search" onclick="document.frmSort.submit()">검색</button>			</dd>		</dl>	</div>	<div class="inbox">		<div class="bdr_top">            <div class="left">                <div class="total">Total : <strong><?=number_format($arrList["total"])?></strong></div>                <div class="down">                </div>            </div>        <div class="bdr_right">            <div class="btns">                <a href="/backoffice/module/member/member_to_xls.php?user_level=<?=urlencode($_REQUEST['user_level'])?>&join_type=<?=urlencode($_REQUEST['join_type'])?>&email_accept=<?=urlencode($_REQUEST['email_accept'])?>&sms_accept=<?=urlencode($_REQUEST['sms_accept'])?>&s_date=<?=urlencode($_REQUEST['s_date'])?>&e_date=<?=urlencode($_REQUEST['e_date'])?>&login_last=<?=urlencode($_REQUEST['login_last'])?>&sw=<?=urlencode($_REQUEST['sw'])?>&sk=<?=urlencode($_REQUEST['sk'])?>&page_size=<?=$scale?>&offset=<?=urlencode($_REQUEST['offset'])?>" class="excel" download>엑셀파일로 저장<span class="pc_vw"></span></a>            </div>			<div class="count">				<select name="page_size" onchange="document.frmSort.submit()" style="width:100px;">                    <option value="0" <?if($scale=="0"){echo 'selected="selected"';}?>>전체</option>                    <option value="500" <?if($scale=="500"){echo 'selected="selected"';}?>>500</option>                    <option value="400" <?if($scale=="400"){echo 'selected="selected"';}?>>400</option>                    <option value="300" <?if($scale=="300"){echo 'selected="selected"';}?>>300</option>                    <option value="200" <?if($scale=="200"){echo 'selected="selected"';}?>>200</option>					<option value="100" <?if($scale=="100"){echo 'selected="selected"';}?>>100</option>					<option value="50" <?if($scale=="50"){echo 'selected="selected"';}?>>50</option>					<option value="40" <?if($scale=="40"){echo 'selected="selected"';}?>>40</option>					<option value="30" <?if($scale=="30"){echo 'selected="selected"';}?>>30</option>					<option value="20" <?if($scale=="20"){echo 'selected="selected"';}?>>20</option>					<option value="15" <?if($scale=="15"){echo 'selected="selected"';}?>>15</option>					<option value="10" <?if($scale=="10"){echo 'selected="selected"';}?>>10</option>				</select>				개씩 보기			</div>		</div>    </div>		</form><!-- over_tbl : 테이블을 좌우로 스크롤 할 때 사용합니다. --><!-- mo_break_tbl : 767px 이하에서 테이블 구조를 깰 때 사용합니다. -->		<div class="over_tbl mo_break_tbl">			<div class="bdr_list tac">				<table>					<colgroup class="pc_vw">						<col class="check">						<col class="w4p">						<col class="w8p">						<col class="w8p">						<col class="w8p">						<col class="w12p">						<col class="w10p">						<col class="w8p">						<col class="w12p">						<col class="w10p">                        <col class="w10p">                        <col class="w10p">					</colgroup>					<thead>						<tr>								<th><label class="check notxt"><input type="checkbox" name="" id="allCheck"><i></i></label></th>							<th class="pc_vw">No.</th>                            <th class="pc_vw">회원상태</th>							<th class="pc_vw">아이디</th>                            <th class="pc_vw">회원구분</th>							<th class="pc_vw">이름</th>							<th class="pc_vw">소속/위치</th>							<th class="pc_vw">연락처</th>							<th class="pc_vw">최종연회비</th>							<th class="pc_vw">최종구독비</th>                            <th class="pc_vw">입회일자</th>							<th class="pc_vw">관리</th>						</tr>					</thead>					<tbody>					<?					if($arrList['list']['total'] > 0){						for ($i=0;$i<$arrList['list']['total'];$i++){							$newTxt = "";							for($c=0;$c<$arrCount['total'];$c++){								if($arrCount['list'][$c]['user_editdt']==$arrList['list'][$i]['user_editdt']){									$newTxt = "New";								}							}					?>                        <tr data-email="<?=$email?>">							<td class="chkbox"><label class="check notxt"><input type="checkbox" value="<?=$arrList["list"][$i]['idx']?>" name="chk_list"><i></i></label></td>							<td><i class="mo_vw">No.</i><?=number_format($arrList['total']-$i-$_REQUEST['offset'])?></td>                            <td><i class="mo_vw">회원상태</i><?=$arrMemberGrade[$arrList['list'][$i]['mstatus']]?></td>                            <td><i class="mo_vw">아이디</i><?=$arrList['list'][$i]['loginid']?></td>                            <td><i class="mo_vw">회원구분</i><?=getPolyCategoryName($arrList['list'][$i]['memcode'])?></td>                            <td><i class="mo_vw">이름</i><?=$arrList['list'][$i]['namek']?></td>                            <td><i class="mo_vw">소속/직위</i><?=$arrList['list'][$i]['affiliation']?> <?=$arrList['list'][$i]['department']?> <?=$arrList['list'][$i]['pos']?></td>                            <td><i class="mo_vw">연락처</i><?=$arrList['list'][$i]['cphone']?></td>                            <td><i class="mo_vw">최종연회비</i><?=$arrList['list'][$i]['updated']?></td>                            <td><i class="mo_vw">최종구독비</i><?=getPaidSubscription($arrList['list'][$i]['memberid'])?></td>                            <td><i class="mo_vw">입회일자</i><?=$arrList['list'][$i]['inserted']?></td>							<td class="mono_btm"><i class="mo_vw">관리</i>								<div class="btns">									<a href="member_info.php?memberid=<?=$arrList['list'][$i]['memberid']?>" class="btn perf">수정</a>									<button type="button" class="btn del" onclick="delMember('<?=$arrList['list'][$i]['user_id']?>');">탈퇴</button>								</div>							</td>						</tr>					<?						}					}else{					?>					<tr height="100">						<td colspan="7">등록된 데이터가 없습니다.</td>					</tr>					<?}?>					</tbody>				</table>			</div>		</div>		<div class="bdr_btm">			<div class="paging">						<?			############### paging ############### ST			$queryString = explode("&",$_SERVER['QUERY_STRING']);			$reQueryString = "";			$comma = "";			for($i=0;$i<count($queryString);$i++){				if(strpos($queryString[$i],"offset=")===false){					$reQueryString .= $comma.$queryString[$i];					$comma = "&";				}			}			echo pageNavigationBackoffice($arrList["total"],$scale,10,$_GET['offset'],$reQueryString);			############### paging ############### ED			?>						</div>            <div class="btns" style="right:unset;">                <a href="javascript:void(0);" onclick="getSelections('sms')" class="btn btn_del">문자발송</a>                <select name="sms_options" style="width:120px;">                    <option value="">선택</option>					<?php foreach ($arrBoardSmsList["list"] as $sms): ?>						<?php if (!empty($sms['idx']) && !empty($sms['subject'])): ?>                            <option value="<?= $sms['idx'] ?>"><?= $sms['subject'] ?></option>						<?php endif; ?>					<?php endforeach; ?>                </select>                <a href="javascript:void(0);" onclick="getSelections('email')" class="btn btn_del">이메일발송</a>                <select name="email_options" style="width:120px;">                    <option value="">선택</option>					<?php foreach ($arrBoardMailList["list"] as $mail): ?>						<?php if (!empty($mail['idx']) && !empty($mail['subject'])): ?>                            <option value="<?= $mail['idx'] ?>"><?= $mail['subject'] ?></option>						<?php endif; ?>					<?php endforeach; ?>                </select>            </div>			<div class="btns">                <a href="javascript:void(0);" onclick="showViolationModal()" class="btn btn_del">정지/주의등록</a>			<a href="/backoffice/module/member/member_add.php"  class="btn btn">신규등록</a>			</div>		</div>	</div></div><form name="frmContentsHidden" method="post" action="member_evn.php">	<input type="hidden" name="evnMode" value="delete">	<input type="hidden" name="user_id">	<input type="hidden" name="returnURL" value="<?=$_SERVER['REQUEST_URI']?>"></form><script>    document.addEventListener('DOMContentLoaded', function() {        document.querySelector('.container').style.display = 'block';    });</script><script type="text/javascript">//<![CDATA[$(document).ready(function(){//달력	$(".datepicker").datepicker({		dateFormat: 'yy-mm-dd',		showMonthAfterYear:true,		showOn: "both",		buttonImage: "/images/icon_month.gif",         buttonImageOnly: true,		changeYear: true,		changeMonth: true,		yearRange: 'c-100:c+10',		yearSuffix: "년 ",		monthNamesShort: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],		dayNamesMin: ['일','월','화','수','목','금','토']	});//체크박스	var $allCheck = $('#allCheck');	$allCheck.change(function () {		var $this = $(this);		var checked = $this.prop('checked');		$('input[name="chk_list"]').prop('checked', checked);	});	var boxes = $('input[name="chk_list"]');	boxes.change(function () {		var boxLength = boxes.length;		var checkedLength = $('input[name="chk_list"]:checked').length;		var selectallCheck = (boxLength == checkedLength);		$allCheck.prop('checked', selectallCheck);	});});//]]></script><?php include("pub/inc/footer.php") ?>