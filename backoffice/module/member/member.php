<?PHPinclude $_SERVER['DOCUMENT_ROOT'] . "/backoffice/pub/inc/admin_top.php";include $_SERVER['DOCUMENT_ROOT'] . "/backoffice/module/admin/menu.php";include_once $_SERVER ['DOCUMENT_ROOT'] . "/module/member/member.lib.php";include_once $_SERVER ['DOCUMENT_ROOT'] . "/module/member/account.lib.php";include_once $_SERVER ['DOCUMENT_ROOT'] . "/module/board/board.lib.php";if (! in_array ( "member_manage", $_SESSION [$_SITE ["DOMAIN"]] ["ADMIN"] ["AUTH"] ) && $_SESSION [$_SITE ["DOMAIN"]] ["ADMIN"] ["GRADE"] != "ROOT") :	jsMsg ( "권한이 없습니다." );	jsHistory ( "-1" );endif;if ($_GET['page_size']) {	$scale = $_GET['page_size'];} elseif ($_GET['page_size'] === '0') {	$scale = 0;} else {	$scale = 20;}// DB연결$dblink = SetConn ( $_conf_db ["main_db"] );$arrList = getMemberList($scale, $_REQUEST['offset']);$arrMemCode = getPolyCategoryOption("회원구분");$arrBranchCategory = getPolyCategoryOption("지부");$arrJobTypeCategory = getPolyCategoryOption("직종");$arrGroupCategory = getPolyCategoryOption("학회임원");$chDate = date('Y-m-d H:i:s',strtotime(date("Y-m-d")."-30 day"));   // 한달// DB해제//SetDisConn ( $dblink );?><div class="container">	<div class="title">회원 리스트</div>	<form name="frmSort" method="get" action="member.php">        <div class="inbox top_search">            <dl>                <dt>회원상태</dt>                <dd>                    <select name="mstatus">                        <option value="">선택</option>                        <?php foreach($arrMemberGrade as $code => $name): ?>                            <option value="<?=$code?>" <?=$code==$_GET['mstatus']?" selected":""?>><?=$name?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl>                <dt>정렬조건1</dt>                <dd>                    <select name="orderby1" class="text" style="width:120px;">                        <option value="">선택</option>                        <?php foreach ($arrTransactionSortFeld as $sortno => $sortname): ?>                            <option value="<?= $sortno ?>" <?= $_GET['orderby1'] == $sortno ? "selected" : "" ?>><?= $sortname ?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl>                <dt>정렬조건2</dt>                <dd>                    <select name="orderby2" class="text" style="width:120px;">                        <option value="">선택</option>                        <?php foreach ($arrTransactionSortFeld as $sortno => $sortname): ?>                            <option value="<?= $sortno ?>" <?= isset($_GET['orderby2']) && $_GET['orderby2'] == $sortno ? "selected" : "" ?>><?= $sortname ?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl class="search_wrap">            </dl>            <dl>                <dt>회원구분</dt>                <dd>                    <select name="memcode" class="text" style="width:120px;">                        <option value="">선택</option>                        <?php foreach($arrMemCode as $code => $name): ?>                            <option value="<?=$code?>" <?=$code==$_GET['memcode']?" selected":""?>><?=$name?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl class="search_wrap">            </dl>            <dl>                <dt>이름</dt>                <dd>                    <input type="text" name="namek" value="<?=$_GET['namek']?>" />                </dd>            </dl>            <dl>                <dt>소속</dt>                <dd>                    <input type="text" name="affiliation" value="<?=$_GET['affiliation']?>" />                </dd>            </dl>            <dl>                <dt>아이디</dt>                <dd>                    <input type="text" name="loginid" value="<?=$_GET['loginid']?>" />                </dd>            </dl>            <dl class="search_wrap">            </dl>            <dl>                <dt>휴대전화</dt>                <dd>                    <input type="text" name="cphone" value="<?=$_GET['cphone']?>" />                </dd>            </dl>            <dl>                <dt>이메일</dt>                <dd>                    <input type="text" name="email" value="<?=$_GET['email']?>" />                </dd>            </dl>            <dl>                <dt>학위</dt>                <dd>                    <select name="degree">                        <option value="">선택</option>                        <?php foreach($arrDegree as $code => $name): ?>                            <option value="<?=$code?>" <?=($_GET["degree"] == $code) ? " selected" : ""?>><?=$name?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl class="search_wrap">            </dl>            <dl>                <dt>직종</dt>                <dd>                    <select name="jobcode" class="text" style="width:120px;">                        <option value="">전체</option>                        <?php foreach($arrJobTypeCategory as $code => $name): ?>                            <option value="<?=$code?>" <?=$code==$_GET["jobcode"]?" selected":""?>><?=$name?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl>                <dt>저널구독</dt>                <dd>                    <select name="subscription" class="text" style="width:120px;">                        <option value="">전체</option>                        <option value="1" <?=$_GET['subscription']=="1"?" selected":""?>>구독</option>                        <option value="0" <?=$_GET['subscription']=="0"?" selected":""?>>비구독</option>                    </select>                </dd>            </dl>            <dl class="search_wrap">            </dl>            <dl>                <dt>현임원</dt>                <dd>                    <select name="executive_type" class="text" style="width:120px;">                        <option value="">전체</option>                        <?php foreach($arrGroupCategory as $code => $name): ?>                            <option value="<?=$code?>" <?=$code==$_GET["executive_type"]?" selected":""?>><?=$name?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl>                <dt>차기 임원</dt>                <dd>                    <select name="next_executive_type" class="text" style="width:120px;">                        <option value="">전체</option>                        <?php foreach($arrGroupCategory as $code => $name): ?>                            <option value="<?=$code?>" <?=$code==$_GET["next_executive_type"]?" selected":""?>><?=$name?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl>                <dt>지부/지회</dt>                <dd>                    <select name="brncode" class="text" style="width:120px;">                        <option value="">전체</option>                        <?php foreach($arrBranchCategory as $code => $name): ?>                            <option value="<?=$code?>" <?=$code==$_GET["brncode"]?" selected":""?>><?=$name?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl class="search_wrap">                <dt>검색</dt>                <dd>                    <input type="text" name="search_keyword" value="<?=$_GET['search_keyword']?>" />                    <button type="submit" class="btn date_btn">검색</button>                    <a href="/backoffice/module/member/member.php" class="btn date_btn" style="width: 110px;background:#777;display:inline-block;text-decoration:none;cursor:pointer;text-align:center;">검색조건 초기화</a>                </dd>            </dl>            <dl class="search_wrap">                <dt>지정 검색 조건</dt>                <dd>                    <select name="custom_search" class="text" style="width:120px;">                        <option value="">전체</option>                        <?php foreach ($arrAccountCard as $code => $name): ?>                            <option value="<?=$code?>" <?=$code==$_GET['custom_search'] ? " selected" : ""?>><?=$name?></option>                        <?php endforeach; ?>                    </select>                </dd>            </dl>            <dl class="search_wrap">                <dt>이메일 수신여부</dt>                <dd>                    <select name="custom4" class="text" style="width:120px;">                        <option value="">전체</option>                        <option value="Y" <?=$_GET['custom4']=="Y"?" selected":""?>>수신</option>                        <option value="N" <?=$_GET['custom4']=="N"?" selected":""?>>비수신</option>                    </select>                </dd>            </dl>            <dl class="search_wrap">            </dl>            <dl class="w2">                <dt>가입일</dt>                <dd>                    <input type="text" class="datepicker" name="rsdate" value="<?=$_REQUEST['rsdate']?>" id="rsdate" />                    <em>~</em>                    <input type="text" class="datepicker" name="redate" value="<?=$_REQUEST['redate']?>" id="redate" />                    <div class="date_btns">                        <button type="button" class="btn date_btn" onclick="setDateRange('all', 'join')">전체</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('1month', 'join')">1개월</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('3month', 'join')">3개월</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('6month', 'join')">6개월</button>                    </div>                </dd>            </dl>            <dl class="search_wrap">            </dl>            <dl class="w2">                <dt>회비납부일</dt>                <dd>                    <input type="text" class="datepicker" name="dsdate" value="<?=$_REQUEST['dsdate']?>" id="dsdate" />                    <em>~</em>                    <input type="text" class="datepicker" name="dedate" value="<?=$_REQUEST['dedate']?>" id="dedate" />                    <div class="date_btns">                        <button type="button" class="btn date_btn" onclick="setDateRange('all', 'payment')">전체</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('1month', 'payment')">1개월</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('3month', 'payment')">3개월</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('6month', 'payment')">6개월</button>                    </div>                </dd>            </dl>            <dl class="search_wrap">            </dl>            <dl class="w2">                <dt>구독 회비납부일</dt>                <dd>                    <input type="text" class="datepicker" name="fsdate" value="<?=$_REQUEST['fsdate']?>" id="fsdate" />                    <em>~</em>                    <input type="text" class="datepicker" name="fedate" value="<?=$_REQUEST['fedate']?>" id="fedate" />                    <div class="date_btns">                        <button type="button" class="btn date_btn" onclick="setDateRange('all', 'subscription')">전체</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('1month', 'subscription')">1개월</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('3month', 'subscription')">3개월</button>                        <button type="button" class="btn date_btn" onclick="setDateRange('6month', 'subscription')">6개월</button>                    </div>                </dd>            </dl>        </div>	<div class="inbox">		<div class="bdr_top">            <div class="left">                <div class="total">Total : <strong><?=number_format($arrList["total"])?></strong></div>                <div class="down">                </div>            </div>        <div class="bdr_right">            <div class="btns">                <a href="/backoffice/module/member/member_to_xls.php?user_level=<?=urlencode($_REQUEST['user_level'])?>&join_type=<?=urlencode($_REQUEST['join_type'])?>&email_accept=<?=urlencode($_REQUEST['email_accept'])?>&sms_accept=<?=urlencode($_REQUEST['sms_accept'])?>&s_date=<?=urlencode($_REQUEST['s_date'])?>&e_date=<?=urlencode($_REQUEST['e_date'])?>&login_last=<?=urlencode($_REQUEST['login_last'])?>&sw=<?=urlencode($_REQUEST['sw'])?>&sk=<?=urlencode($_REQUEST['sk'])?>&page_size=<?=$scale?>&offset=<?=urlencode($_REQUEST['offset'])?>" class="excel" download>엑셀파일로 저장<span class="pc_vw"></span></a>            </div>			<div class="count">				<select name="page_size" onchange="document.frmSort.submit()" style="width:100px;">                    <option value="0" <?if($scale=="0"){echo 'selected="selected"';}?>>전체</option>                    <option value="500" <?if($scale=="500"){echo 'selected="selected"';}?>>500</option>                    <option value="400" <?if($scale=="400"){echo 'selected="selected"';}?>>400</option>                    <option value="300" <?if($scale=="300"){echo 'selected="selected"';}?>>300</option>                    <option value="200" <?if($scale=="200"){echo 'selected="selected"';}?>>200</option>					<option value="100" <?if($scale=="100"){echo 'selected="selected"';}?>>100</option>					<option value="50" <?if($scale=="50"){echo 'selected="selected"';}?>>50</option>					<option value="40" <?if($scale=="40"){echo 'selected="selected"';}?>>40</option>					<option value="30" <?if($scale=="30"){echo 'selected="selected"';}?>>30</option>					<option value="20" <?if($scale=="20"){echo 'selected="selected"';}?>>20</option>					<option value="15" <?if($scale=="15"){echo 'selected="selected"';}?>>15</option>					<option value="10" <?if($scale=="10"){echo 'selected="selected"';}?>>10</option>				</select>				개씩 보기			</div>		</div>    </div>		</form><!-- over_tbl : 테이블을 좌우로 스크롤 할 때 사용합니다. --><!-- mo_break_tbl : 767px 이하에서 테이블 구조를 깰 때 사용합니다. -->		<div class="over_tbl mo_break_tbl">			<div class="bdr_list tac">				<table>					<colgroup class="pc_vw">						<col class="check">						<col class="w6p">						<col class="w8p">						<col class="w8p">						<col class="w8p">						<col class="w8p">						<col class="w20p">						<col class="w8p">						<col class="w8p">						<col class="w8p">                        <col class="w8p">                        <col class="w20p">					</colgroup>					<thead>						<tr>								<th><label class="check notxt"><input type="checkbox" name="" id="allCheck"><i></i></label></th>							<th class="pc_vw">No.</th>                            <th class="pc_vw">회원상태</th>							<th class="pc_vw">아이디</th>                            <th class="pc_vw">회원구분</th>							<th class="pc_vw">이름</th>							<th class="pc_vw">소속/위치</th>							<th class="pc_vw">연락처</th>							<th class="pc_vw">최종연회비</th>							<th class="pc_vw">최종구독비</th>                            <th class="pc_vw">입회일자</th>							<th class="pc_vw">관리</th>						</tr>					</thead>					<tbody>					<?					if($arrList['list']['total'] > 0){						for ($i=0;$i<$arrList['list']['total'];$i++){							$newTxt = "";							for($c=0;$c<$arrCount['total'];$c++){								if($arrCount['list'][$c]['user_editdt']==$arrList['list'][$i]['user_editdt']){									$newTxt = "New";								}							}					?>                            <tr data-email="<?=$arrList['list'][$i]['email']?>">							<td class="chkbox"><label class="check notxt"><input type="checkbox" value="<?=$arrList["list"][$i]['memberid']?>" name="chk_list"><i></i></label></td>							<td><i class="mo_vw">No.</i><?=$arrList['total']-$i-$_REQUEST['offset']?></td>                            <td><i class="mo_vw">회원상태</i><?=$arrMemberGrade[$arrList['list'][$i]['mstatus']]?></td>                            <td><i class="mo_vw">아이디</i><?=$arrList['list'][$i]['loginid']?></td>                            <td><i class="mo_vw">회원구분</i><?=getPolyCategoryName($arrList['list'][$i]['memcode'])?></td>                            <td><i class="mo_vw">이름</i><?=$arrList['list'][$i]['namek']?></td>                            <td><i class="mo_vw">소속/직위</i><?=$arrList['list'][$i]['affiliation']?> <?=$arrList['list'][$i]['department']?> <?=$arrList['list'][$i]['pos']?></td>                            <td><i class="mo_vw">연락처</i><?=$arrList['list'][$i]['cphone']?></td>                            <td><i class="mo_vw">최종연회비</i><?=date('Y-m-d', strtotime($arrList['list'][$i]['updated']))?></td>                            <td><i class="mo_vw">최종구독비</i><?=getPaidSubscription($arrList['list'][$i]['memberid'])?></td>                             <td><i class="mo_vw">입회일자</i><?=date('Y-m-d', strtotime($arrList['list'][$i]['inserted']))?></td>                             <td class="mono_btm"><i class="mo_vw">관리</i>                                    <div class="btns">                                        <a href="javascript:void(0);" onclick="copyEmail(this)" class="btn" data-email="<?=$arrList['list'][$i]['email']?>">이메일 복사</a>                                        <a href="member_info.php?memberid=<?=$arrList['list'][$i]['memberid']?>" class="btn perf">수정</a>                                        <button type="button" class="btn del" onclick="delMember('<?=$arrList['list'][$i]['memberid']?>');">삭제</button>                                    </div>                                </td>						</tr>					<?						}					}else{					?>					<tr height="100">						<td colspan="7">등록된 데이터가 없습니다.</td>					</tr>					<?}?>					</tbody>				</table>			</div>		</div>		<div class="bdr_btm">			<div class="paging">						<?			############### paging ############### ST			$queryString = explode("&",$_SERVER['QUERY_STRING']);			$reQueryString = "";			$comma = "";			for($i=0;$i<count($queryString);$i++){				if(strpos($queryString[$i],"offset=")===false){					$reQueryString .= $comma.$queryString[$i];					$comma = "&";				}			}			echo pageNavigationBackoffice($arrList["total"],$scale,10,$_GET['offset'],$reQueryString);			############### paging ############### ED			?>						</div>            <div class="btns" style="right:unset;">                <a href="javascript:void(0);" onclick="deleteSelectedMembers()" class="btn btn_del">선택 삭제</a>                <a href="javascript:void(0);" onclick="" class="btn btn_del" style="width: 110px">전체 구독 초기화</a>                <a href="javascript:void(0);" onclick="" class="btn btn_del" style="width: 150px">특별, 단체회원 외 초기화</a>            </div>		</div>	</div></div><form name="frmContentsHidden" method="post" action="member_evn.php">	<input type="hidden" name="evnMode" value="delete">    <input type="hidden" name="evnSubMode" value="batch_delete">	<input type="hidden" name="memberid">	<input type="hidden" name="returnURL" value="<?=$_SERVER['REQUEST_URI']?>"></form>    <style>        .bdr_btm .btns .btn_del {            width: auto;            padding-left: 10px;            padding-right: 10px;        }        .bdr_btm .btns .btn,        .mono_btm .btns .btn {            width: 80px;            text-align: center;            box-sizing: border-box;        }    </style>    <style>        .date_btn {            font-size: 12px;            color: #fff;            font-weight: 700;            line-height: 30px;            height: 30px;            width: 70px;            text-align: center;            background: #3e4450;            border-radius: 3px;            margin-right: 8px;        }    </style>    <script>        function deleteSelectedMembers() {            var selectedItems = $('input:checkbox[name=chk_list]:checked');            if (selectedItems.length === 0) {                alert('삭제할 항목을 선택해주세요.');                return;            }            if (confirm('선택한 ' + selectedItems.length + '개 항목을 삭제하시겠습니까?\n삭제 후에는 복구할 수 없습니다.')) {                // 선택된 회원 ID 수집                var selectedIds = [];                selectedItems.each(function() {                    var memberId = $(this).val();                    selectedIds.push(memberId);                });                // 폼 데이터 설정 및 제출                var form = document.frmContentsHidden;                form.evnMode.value = "delete";                form.evnSubMode.value = "batch_member"; // 일괄 삭제 모드 추가                form.memberid.value = selectedIds.join(',');                form.submit();            }        }        function copyEmail(element) {            const email = element.getAttribute('data-email');            if (!email) {                alert('복사할 이메일이 없습니다.');                return;            }            // 현대 브라우저용 Clipboard API            if (navigator.clipboard && window.isSecureContext) {                navigator.clipboard.writeText(email)                    .then(() => {                        alert('이메일이 클립보드에 복사되었습니다: ' + email);                    })                    .catch(err => {                        alert('이메일 복사 중 오류가 발생했습니다: ' + err);                    });            } else {                // 구형 브라우저용 대체 방법                const textarea = document.createElement('textarea');                textarea.value = email;                textarea.style.position = 'fixed';                document.body.appendChild(textarea);                textarea.select();                try {                    document.execCommand('copy');                    alert('이메일이 클립보드에 복사되었습니다: ' + email);                } catch (err) {                    alert('이메일 복사 중 오류가 발생했습니다: ' + err);                } finally {                    document.body.removeChild(textarea);                }            }        }        // 선택 삭제시 singleSelect=true 값 변경 false        function getSelectionMemeber(selectedValue) {            var ss = "0";            var rows = $('input:checkbox[name=chk_list]:checked');            for (var i = 0; i < rows.length; i++) {                var row = rows[i];                ss += "," + row.value;            }            if (rows.length > 0) {                memberLevel(ss, selectedValue);            } else {                alert('선택된 항목이 없습니다.');            }        }        function boardDel(val){            //location.href="/backoffice/module/member/ajax_member_del.php?g_idx="+val;            //return;            //alert(val);            //return;            if(confirm("탈퇴 처리 하시겠습니까?")) {                $.post("/backoffice/module/member/ajax_member_del.php", {g_idx: val },                    function(data){                        //alert(data);                        location.reload();                    });            }        }        function memberLevel(idx, lval){            if(confirm("수정 하시겠습니까?")) {                $.post("/backoffice/module/member/ajax_member_level.php", {                        g_idx: idx,                        levelval: lval,                        child_violation: $('#child_violation').val(),                        child_category: lval,                        child_violation_wdate: $('#child_violation_wdate').text(),                        child_violation_start_date: $('#child_violation_start_date').val(),                        child_violation_end_date: $('#child_violation_end_date').val()                    },                    function(data){                        //alert(data);                        location.reload();                    });            }        }        function delMember(id){            var cfm;            cfm =false;            cfm = confirm(" 이 회원을 탈퇴처리 하시겠습니까?\n\n탈퇴처리시 복구 불가능합니다.");            if(cfm==true){                document.frmContentsHidden.memberid.value = id;                document.frmContentsHidden.submit();            }        }        // 선택 삭제시 singleSelect=true 값 변경 false        function getSelections(action) {            var ss = "0";            var rows = $('input:checkbox[name=chk_list]:checked');            // Collect selected IDs            for(var i=0; i<rows.length; i++){                var row = rows[i];                ss += "," + row.value;            }            if(rows.length > 0){                switch(action) {                    case 'delete':                        boardDel(ss);                        break;                    case 'sms':                        sendSMS(rows);                        break;                    case 'email':                        sendEmail(rows);                        break;                    default:                        alert('올바른 작업을 선택해주세요.');                        break;                }            } else {                alert('선택된 항목이 없습니다.');            }        }    </script><script>    document.addEventListener('DOMContentLoaded', function() {        document.querySelector('.container').style.display = 'block';    });//<![CDATA[$(document).ready(function(){//달력	$(".datepicker").datepicker({		dateFormat: 'yy-mm-dd',		showMonthAfterYear:true,		showOn: "both",		buttonImage: "/images/icon_month.gif",         buttonImageOnly: true,		changeYear: true,		changeMonth: true,		yearRange: 'c-100:c+10',		yearSuffix: "년 ",		monthNamesShort: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],		dayNamesMin: ['일','월','화','수','목','금','토']	});//체크박스	var $allCheck = $('#allCheck');	$allCheck.change(function () {		var $this = $(this);		var checked = $this.prop('checked');		$('input[name="chk_list"]').prop('checked', checked);	});	var boxes = $('input[name="chk_list"]');	boxes.change(function () {		var boxLength = boxes.length;		var checkedLength = $('input[name="chk_list"]:checked').length;		var selectallCheck = (boxLength == checkedLength);		$allCheck.prop('checked', selectallCheck);	});});//]]></script><?php include("pub/inc/footer.php") ?>